<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="description" content="" />
<meta name="keywords" content="" />
<meta name="robots" content="INDEX,FOLLOW" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" href="https://www.totalphase.com/media/favicon/default/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="https://www.totalphase.com/media/favicon/default/favicon.ico" type="image/x-icon" />
<!--[if lt IE 7]>
<script type="text/javascript">
//<![CDATA[
    var BLANK_URL = 'https://www.totalphase.com/js/blank.html';
    var BLANK_IMG = 'https://www.totalphase.com/js/spacer.gif';
//]]>
</script>
<![endif]-->

<link rel="stylesheet" type="text/css" href="https://www.totalphase.com/media/css_secure/5bb9832d18f599aecb3e700c4d4810e6.css" />
<link rel="stylesheet" type="text/css" href="https://www.totalphase.com/media/css_secure/fb44dea4b743984eacba7e03908e12f3.css" media="all" />
<link rel="stylesheet" type="text/css" href="https://www.totalphase.com/media/css_secure/65a0b1dc03849218760cc7187c5d1084.css" media="print" />
<script type="text/javascript" src="https://www.totalphase.com/media/js/9a56e02c0907f9d599f46b159b8cfc42.js"></script>
<!--[if lt IE 8]>
<link rel="stylesheet" type="text/css" href="https://www.totalphase.com/media/css_secure/90dbb19d247e27dbfb1804ad9a851836.css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<script type="text/javascript" src="https://www.totalphase.com/media/js/c99cbc21af293b1a096e2426653b76f6.js"></script>
<![endif]-->

<script type="text/javascript">
//<![CDATA[
Mage.Cookies.path     = '/';
Mage.Cookies.domain   = '.www.totalphase.com';
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
optionalZipCountries = ["HK","IE","MO","PA"];
//]]>
</script>
<script type="text/javascript">jQuery.noConflict();</script>
                


<script type="text/javascript">
(function e(){var e=document.createElement("script");e.type="text/javascript",e.async=true,e.src="//staticw2.yotpo.com/gNaAZ4CRNeItAZFB0VaXfghYpOLlYxOMAay6rghP/widget.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();
</script><script type="text/javascript">//<![CDATA[
        var Translator = new Translate({"Please use numbers only in this field. Please avoid spaces or other characters such as dots or commas.":"Please use numbers only in this field."});
        //]]></script><meta name="google-site-verification" content="D3n5dMrtiuu_pZMUqhhsx0ctgQZ8E7OKNu1qVxq9Pas" />
<meta name="norton-safeweb-site-verification" content="ext183b66a1uy3w21g2kyw-53goc5vp0qgqk7sfua2-t4o7tc22cgcm05vbkzm2z4e0x8708h4zisd-9qjttpvevof0dvga9to-fto-9jhrjc40zshomleu6hldkfp7n" />
<!--eefd50d3957baacf58ebbe8dbae61ca8-->
<!-- preload font for improved display performance-->
<link rel="preload" href="/skin/frontend/default/totalphase/fonts/lato-regular-webfont.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="/skin/frontend/default/totalphase/fonts/futural-webfont.woff" as="font" type="font/woff" crossorigin>
<!--6c01183419ea3d87d1034ece12fb66aa--><!--GOOGLE ANALYTICS HTTPS SITE VERIFICATION CODE--> <!-- BEGIN GOOGLE ANALYTICS CODE -->
<div style="display: none;">
<script type="text/javascript">// <![CDATA[
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-230578-1', 'auto');
  ga('send', 'pageview');
// ]]></script>
</div>
<!-- END GOOGLE ANALYTICS CODE --> <!--OPTIMIZELY ORGANIC SEARCH CODE-->
<div style="display: none;">&nbsp;</div>
<!-- Hotjar Tracking Code for http://www.totalphase.com/ -->
<div style="display: none;">
<script type="text/javascript">// <![CDATA[
(function(h,o,t,j,a,r){
h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
h._hjSettings={hjid:392616,hjsv:5};
a=o.getElementsByTagName('head')[0];
r=o.createElement('script');r.async=1;
r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
a.appendChild(r);
})(window,document,'//static.hotjar.com/c/hotjar-','.js?sv=');
// ]]></script>
</div>
<!--END OPTIMIZELY ORGANIC SEARCH CODE--> <!--BING TRACKING CODE-->
<script type="text/javascript">// <![CDATA[
(function(w,d,t,r,u){var f,n,i;w[u]=w[u]||[],f=function(){var o={ti:"5711029"};o.q=w[u],w[u]=new UET(o),w[u].push("pageLoad")},n=d.createElement(t),n.src=r,n.async=1,n.onload=n.onreadystatechange=function(){var s=this.readyState;s&&s!=="loaded"&&s!=="complete"||(f(),n.onload=n.onreadystatechange=null)},i=d.getElementsByTagName(t)[0],i.parentNode.insertBefore(n,i)})(window,document,"script","//bat.bing.com/bat.js","uetq");
// ]]></script>
<noscript>&lt;img src="//bat.bing.com/action/0?ti=5711029&amp;Ver=2" height="0" width="0" style="display:none; visibility: hidden;" /&gt;</noscript><!--END BING TRACKING CODE--> <!--LINKEDIN INSIGHTS TAG-->
<div style="display: none;">
<script type="text/javascript">// <![CDATA[
_linkedin_data_partner_id = "71669";
// ]]></script>
<script type="text/javascript">// <![CDATA[
(function(){var s = document.getElementsByTagName("script")[0];
var b = document.createElement("script");
b.type = "text/javascript";b.async = true;
b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js";
s.parentNode.insertBefore(b, s);})();
// ]]></script>
</div>
<noscript>&lt;img height="1" width="1" style="display:none;" alt="" src="https://dc.ads.linkedin.com/collect/?pid=71669&amp;fmt=gif" /&gt;</noscript><!--END LINKEDIN INSIGHTS TAG--><script>
 jQuery( document ).ready(function() {
    var country = 'AU';
    if(country=='CN'){
    jQuery("p.china").show();
    jQuery("p.others").hide();
   }else{
    jQuery("p.china").hide();
    jQuery("p.others").show();
   }
});

</script>
  <meta charset="utf-8" />
  <!-- v17756 -->
  <title>Aardvark I2C/SPI Host Adapter User Manual &ndash; Total Phase</title>
  <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="" />
  <meta name="description" content="AUTO GENERATED - DO NOT MODIFY      1 General Overview  1.1 I2C Background 1.2 SPI Background    2 Hardware Specifications  2.1 Pinouts..." /><meta property="og:image" content="https://theme.zdassets.com/theme_assets/395267/6ca89ca874924f7f4374287140b40727e36f98c7.png" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Total Phase" />
<meta property="og:title" content="Aardvark I2C/SPI Host Adapter User Manual" />
<meta property="og:description" content="AUTO GENERATED - DO NOT MODIFY 
1 General Overview
1.1 I2C Background
1.2 SPI Background
2 Hardware Specifications
2.1 Pinouts
2.2 Signal Levels/Voltage Ratings
2.3 I2C Signaling Character..." />
<meta property="og:url" content="http://totalphase.zendesk.com/support/articles/200468316-Aardvark-I2C-SPI-Host-Adapter-User-Manual" />
<link rel="canonical" href="https://www.totalphase.com/support/articles/200468316-Aardvark-I2C-SPI-Host-Adapter-User-Manual" />
<link rel="alternate" hreflang="en" href="https://www.totalphase.com/support/articles/200468316-Aardvark-I2C-SPI-Host-Adapter-User-Manual" />
  <link rel="stylesheet" media="all" href="//static.zdassets.com/hc/assets/application-ebbf4a70487f9466c9be47bf4b6055f6.css" id="stylesheet" />
    <!-- Entypo pictograms by Daniel Bruce — www.entypo.com -->
    <link rel="stylesheet" media="all" href="//static.zdassets.com/hc/assets/theming_v1_support-7eacdab8920220a42cfc91404f4ed182.css" />
  <link rel="stylesheet" type="text/css" href="//p14.zdassets.com/hc/theming_assets/395267/1311766/style.css?digest=360183670534" />
  <link rel="shortcut icon" type="image/x-icon" href="//theme.zdassets.com/theme_assets/395267/dc011bb4bc58379307ed77779f7239c61155cb25.png" />
    <script src="//static.zdassets.com/hc/assets/jquery-d5395f0b7ac5027403fc17855c46dbfc.js"></script>
    
    
  
  <script type="text/javascript" src="//p14.zdassets.com/hc/theming_assets/395267/1311766/script.js?digest=360183670534"></script>
<style>
.search input[type=search] { padding: 4px 8px;}
#zendesk .form-field p { margin: 0 350px 0 250px; color: #999; font-size: 12px;}
#zendesk .form-field input[type=text] { width: 350px;}
#zendesk .form-field input[type=field] { width: 350px; border: 1px solid #ccc;}
#zendesk select { width: 360px;}
#upload-dropzone { display: inline-block;}
 select optgroup{
    color:#000;
    font-style:Italic;
    font-weight:bold;
    }
	
#zendesk .pagination ul { margin: 15px 0;}
#zendesk .pagination ul > li { margin: 0 6px 0 0; padding: 0; min-width: 14px; min-height: 16px; line-height: 16px; list-style: none; display: inline-block;}
#zendesk .pagination ul > li { border: 1px solid #ccc;}
 #zendesk .pagination ul > li:hover { border-color: #e56120;}
#zendesk .pagination ul > li a { padding: 3px 6px; transition: all .5s ease; display: block;}
#zendesk .pagination ul > li.pagination-current { padding: 3px 0 0 5px; border-color: transparent;}
#zendesk .pagination ul > li a:hover { background: #e56120; color: #fff;}
#zendesk .pagination ul > li.pagination-next, #zendesk .pagination ul > li.pagination-previous { min-width: 20px; font-weight: bold;}
</style>

</head>
<body class=" zendesk-articles-200468316-aardvark-i2c-spi-host-adapter-user-manual">
<div class="wrapper">
  <div class="page gsdgds">
    <script type="text/javascript">
var $jq = jQuery.noConflict();
	$jq(document).ready(function(){
    $jq(".toggle-menu-btn").click(function(){
		$jq(".header-menu").slideToggle("slow");
    });
    $jq(".global-navigation li:first-child").click(function(){
		$jq("#top-menu-protocol .sub-nav").slideToggle("slow");
    });
});
</script>


<div class="header-container as">
  <div class="header">
    <div class="header-logo">
      <a href="https://www.totalphase.com/" title="Total Phase" class="logo"><strong>Total Phase</strong><img src="https://www.totalphase.com/skin/frontend/default/totalphase/images/logo.png" alt="Total Phase" /></a>
    </div>
    <div class="header-cart">
      <ul class="link cart-navigation">
        <li>
          <a href="https://www.totalphase.com/checkout/cart/" class="icon-cartsm" style="margin-left: 0;" alt="Shopping Cart" title="Shopping Cart" >
            <span style="padding-right:4px;">
            </span>
          </a>
        </li>
      </ul>
    </div>
    <div class="header-links">
      <ul class="link user-navigation">
      <li class="first" >
            <a href="https://www.totalphase.com/customer/account/create/" title="Register" >
    Register</a>
                    </li>
        <li class="last" >
            <a href="https://www.totalphase.com/customer/account/login/?referer=aHR0cHM6Ly93d3cudG90YWxwaGFzZS5jb20vc3VwcG9ydC9hcnRpY2xlcy8yMDA0NjgzMTYtQWFyZHZhcmstSTJDLVNQSS1Ib3N0LUFkYXB0ZXItVXNlci1NYW51YWw_X19fU0lEPVU%2C" title="Login" >
    Login</a>
                    </li>
  </ul>
    </div>
	
	<span class="header-clear"></span>
    <a href="#" class="toggle-menu-btn">
		<span></span>
		<span></span>
		<span></span>
		<span></span>
    </a>

    <div class="header-menu">
      <ul class="global-navigation">
  <li id="top-menu-protocol">
    <a href="javascript:void(0);" id="catName">Protocol</a>
    <div class="sub-nav animated fadeInDown">
                            <a href="https://www.totalphase.com/protocols/can/">
          CAN        </a>
                        <a href="https://www.totalphase.com/protocols/i2c/">
          I2C        </a>
                        <a href="https://www.totalphase.com/protocols/spi/">
          SPI        </a>
                        <a href="https://www.totalphase.com/protocols/usb/">
          USB        </a>
                        <a href="https://www.totalphase.com/protocols/espi/">
          eSPI        </a>
                        <a href="https://www.totalphase.com/protocols/a2b/">
          A²B        </a>
                        <a href="https://www.totalphase.com/protocols/factory/">
          Factory        </a>
              </div>
  </li>
  <li id="top-menu-store"> <a href="https://www.totalphase.com/store/">Store</a> </li>
  <li id="top-menu-search">
    <a href="javascript:void(0);" class="navSrch">Search</a>
    <form id="search_mini_form" action="https://www.totalphase.com/catalogsearch/result/" method="get">


    <div class="nav-srch">
        <i class="icon-srch"></i>
        <input id="search" type="text" class="scrch-inbox" name="q" value="" maxlength="128"  />
        <div id="search_autocomplete" class="search-autocomplete"></div>
        <script type="text/javascript">
            var searchForm = new Varien.searchForm('search_mini_form', 'search', '');
                    </script>

    </div>
    <input type="hidden" name="order" value="price" />
    <input type="hidden" name="dir" value="desc" />
</form>
  </li>
  <li id="top-menu-support">
    <a href="/support/">Support</a>
  </li>
</ul>

<script type="text/javascript">
  function topMenuSetActive (id) {
    var li = document.getElementById(id);
    li.setAttribute('class', 'active');
  }
  function topMenuCatName (name) {
    var a = document.getElementById('catName');
    a.innerHTML = 'Protocol&nbsp;&nbsp;|&nbsp;&nbsp;' + name;
  }

  if (document.querySelector('body.cms-no-route') == null) {
    url = window.location.pathname;
    if (url.indexOf('/protocols/') == 0) {
      topMenuSetActive('top-menu-protocol');
      category = url.split('/')[2].toUpperCase();
      topMenuCatName(category);
    }
    else if (url.indexOf('/products/') == 0)
      topMenuSetActive('top-menu-protocol');
    else if (url.indexOf('/store/') == 0)
      topMenuSetActive('top-menu-store');
    else if (url.indexOf('/support/') == 0)
      topMenuSetActive('top-menu-support');
  }
</script>
    </div>
      </div>
</div>
    <div class="error"> </div>
      
  
  <div id="zendesk" class="main-container col1-layout">
<div class="main">
<div class="col-main">
<div class="std">
<div class="search">
  <form role="search" class="search-small" data-search="" action="/support/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" /><input type="search" name="query" id="query" placeholder="Search" aria-label="Search" /></form>
</div>
  <main role="main">
    <div class="page-title">
  <span class="left">
    <ol class="breadcrumbs">
  
    <li title="Total Phase">
      
        <a href="/support/">Total Phase</a>
      
    </li>
  
    <li title="User Manuals">
      
        <a href="/support/categories/200025748-User-Manuals">User Manuals</a>
      
    </li>
  
    <li title="Hardware">
      
        <a href="/support/sections/200089537-Hardware">Hardware</a>
      
    </li>
  
</ol>
  </span>
  <span class="center">&nbsp;</span>
  <span class="right">
    <a href="/support/requests">My Activities</a>
    &nbsp;|&nbsp;
    <a href="/support/requests/new?ticket_form_id=37143">New Request</a>
  </span>
</div>
<div class="page-summary">
  <div class="article-title"> Aardvark I2C/SPI Host Adapter User Manual</div>
</div>
<div class="article-body">
  <!-- AUTO GENERATED - DO NOT MODIFY -->
<div class="user-manual">
<div class="contents">
<ul>
<li><a href="#s1">1 General Overview</a>
<ul>
<li><a href="#s1.1">1.1 <span style="white-space: nowrap;">I<sup>2</sup>C</span> Background</a></li>
<li><a href="#s1.2">1.2 SPI Background</a></li>
</ul>
</li>
<li><a href="#s2">2 Hardware Specifications</a>
<ul>
<li><a href="#s2.1">2.1 Pinouts</a></li>
<li><a href="#s2.2">2.2 Signal Levels/Voltage Ratings</a></li>
<li><a href="#s2.3">2.3 <span style="white-space: nowrap;">I<sup>2</sup>C</span> Signaling Characteristics</a></li>
<li><a href="#s2.4">2.4 SPI Signaling Characteristics</a></li>
<li><a href="#s2.5">2.5 USB 1.1 Compliance</a></li>
<li><a href="#s2.6">2.6 Physical Specifications</a></li>
<li><a href="#s2.7">2.7 Temperature Specifications</a></li>
</ul>
</li>
<li><a href="#s3">3 Software</a>
<ul>
<li><a href="#s3.1">3.1 Compatibility</a></li>
<li><a href="#s3.2">3.2 Windows USB Driver</a></li>
<li><a href="#s3.3">3.3 Linux USB Driver</a></li>
<li><a href="#s3.4">3.4 Mac OS X USB Driver</a></li>
<li><a href="#s3.5">3.5 USB Port Assignment</a></li>
<li><a href="#s3.6">3.6 Aardvark Dynamically Linked Library</a></li>
<li><a href="#s3.7">3.7 Rosetta Language Bindings: API Integration into Custom Applications</a></li>
<li><a href="#s3.8">3.8 Application Notes</a></li>
</ul>
</li>
<li><a href="#s4">4 Firmware</a>
<ul>
<li><a href="#s4.1">4.1 Field Upgrades</a></li>
</ul>
</li>
<li><a href="#s5">5 API Documentation</a>
<ul>
<li><a href="#s5.1">5.1 Introduction</a></li>
<li><a href="#s5.2">5.2 General Data Types</a></li>
<li><a href="#s5.3">5.3 Notes on Status Codes</a></li>
<li><a href="#s5.4">5.4 General</a></li>
<li><a href="#s5.5">5.5 <span style="white-space: nowrap;">I<sup>2</sup>C</span> Interface</a></li>
<li><a href="#s5.6">5.6 SPI Interface</a></li>
<li><a href="#s5.7">5.7 GPIO Interface</a></li>
<li><a href="#s5.8">5.8 Error Codes</a></li>
</ul>
</li>
<li><a href="#s6">6 Legal / Contact</a>
<ul>
<li><a href="#s6.1">6.1 Disclaimer</a></li>
<li><a href="#s6.2">6.2 Life Support Equipment Policy</a></li>
<li><a href="#s6.3">6.3 Contact Information</a></li>
</ul>
</li>
</ul>
</div>
<div id="pageheader">
<table>
<tbody>
<tr>
<td class="left"><img src="/media/docs/aardvark_man/tplogo.png" alt="" /></td>
<td class="right">Aardvark I2C/SPI Host Adapter User Manual</td>
</tr>
</tbody>
</table>
</div>
<h1 id="s1">1 General Overview</h1>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s1.1">1.1 <span style="white-space: nowrap;">I<sup>2</sup>C</span> Background</h2>
<h3 id="s1.1.1">1.1.1 <span style="white-space: nowrap;">I<sup>2</sup>C</span> History</h3>
<p>When connecting multiple devices to a microcontroller, the address and data lines of each devices were conventionally connected individually. This would take up precious pins on the microcontroller, result in a lot of traces on the PCB, and require more components to connect everything together. This made these systems expensive to produce and susceptible to interference and noise.</p>
<p>To solve this problem, Philips developed Inter-IC bus, or <span style="white-space: nowrap;">I<sup>2</sup>C</span>, in the 1980s. <span style="white-space: nowrap;">I<sup>2</sup>C</span> is a low-bandwidth, short distance protocol for on board communications. All devices are connected through two wires: serial data (SDA) and serial clock (SCL).</p>
<div id="fig.iic1" class="figure"><center><img src="/media/docs/aardvark_man/i2c-01.png" alt="" /></center>
<div><strong> Figure 1</strong> : Sample <span style="white-space: nowrap;">I<sup>2</sup>C</span> Implementation. – Regardless of how many slave units are attached to the <span style="white-space: nowrap;">I<sup>2</sup>C</span> bus, there are only two signals connected to all of them. Consequently, there is additional overhead because an addressing mechanism is required for the master device to communicate with a specific slave device.</div>
</div>
<p>Because all communication takes place on only two wires, all devices must have a unique address to identify it on the bus. Slave devices have a predefined address, but the lower bits of the address can be assigned to allow for multiples of the same devices on the bus.</p>
<h3 id="s1.1.2">1.1.2 <span style="white-space: nowrap;">I<sup>2</sup>C</span> Theory of Operation</h3>
<p><span style="white-space: nowrap;">I<sup>2</sup>C</span> has a master/slave protocol. The master initiates the communication. Here is a simplified description of the protocol. For precise details, please refer to the Philips <span style="white-space: nowrap;">I<sup>2</sup>C</span> specification. The sequence of events are as follows:</p>
<ol>
<li>The master device issues a start condition. This condition informs all the slave devices to listen on the serial data line for their respective address.</li>
<li>The master device sends the address of the target slave device and a read/write flag.</li>
<li>The slave device with the matching address responds with an acknowledgment signal.</li>
<li>Communication proceeds between the master and the slave on the data bus. Both the master and slave can receive or transmit data depending on whether the communication is a read or write. The transmitter sends 8 bits of data to the receiver, which replies with a 1 bit acknowledgment.</li>
<li>When the communication is complete, the master issues a stop condition indicating that everything is done.</li>
</ol>
<p>Figure <a href="#fig.iic2">2</a> shows a sample bitstream of the <span style="white-space: nowrap;">I<sup>2</sup>C</span> protocol.</p>
<div id="fig.iic2" class="figure"><center><img src="/media/docs/aardvark_man/i2c-02.png" alt="" /></center>
<div><strong> Figure 2</strong> : <span style="white-space: nowrap;">I<sup>2</sup>C</span> Protocol. – Since there are only two wires, this protocol includes the extra overhead of the addressing and acknowledgement mechanisms.</div>
</div>
<h3 id="s1.1.3">1.1.3 <span style="white-space: nowrap;">I<sup>2</sup>C</span> Features</h3>
<p><span style="white-space: nowrap;">I<sup>2</sup>C</span> has many features other important features worth mentioning. It supports multiple data speeds: standard (100 kbps), fast (400 kbps), and high speed (3.4 Mbps) communications.</p>
<p>Other features include:</p>
<ul>
<li>Built-in collision detection,</li>
<li>10-bit Addressing,</li>
<li>Multi-master support,</li>
<li>Data broadcast (general call).</li>
</ul>
<p>For more information about other features, see the references at the end of this section.</p>
<h3 id="s1.1.4">1.1.4 <span style="white-space: nowrap;">I<sup>2</sup>C</span> Benefits and Drawbacks</h3>
<p>Since only two wires are required, <span style="white-space: nowrap;">I<sup>2</sup>C</span> is well suited for boards with many devices connected on the bus. This helps reduce the cost and complexity of the circuit as additional devices are added to the system.</p>
<p>Due to the presence of only two wires, there is additional complexity in handling the overhead of addressing and acknowledgments. This can be inefficient in simple configurations and a direct-link interface such as SPI might be preferred.</p>
<h3 id="s1.1.5">1.1.5 <span style="white-space: nowrap;">I<sup>2</sup>C</span> References</h3>
<ul>
<li><a href="http://www.nxp.com/products/interface_control/i2c/index.html"><span style="white-space: nowrap;">I<sup>2</sup>C</span> bus</a> – <em>NXP (Philips) Semiconductors Official <span style="white-space: nowrap;">I<sup>2</sup>C</span> website </em></li>
<li><a href="http://www.esacademy.com/faq/i2c/"><span style="white-space: nowrap;">I<sup>2</sup>C</span> (Inter-Integrated Circuit) Bus Technical Overview and Frequently Asked Questions</a> – <em>Embedded Systems Academy </em></li>
<li><a href="http://www.embedded.com/story/OEG20010718S0073">Introduction to <span style="white-space: nowrap;">I<sup>2</sup>C</span></a> – <em>Embedded.com </em></li>
<li><a href="http://dmoz.org/Computers/Hardware/Buses/I2C/"><span style="white-space: nowrap;">I<sup>2</sup>C</span></a> – <em>Open Directory Project Listing </em></li>
</ul>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s1.2">1.2 SPI Background</h2>
<h3 id="s1.2.1">1.2.1 SPI History</h3>
<p>SPI is a serial communication bus developed by Motorola. It is a full-duplex protocol which functions on a master-slave paradigm that is ideally suited to data streaming applications.</p>
<h3 id="s1.2.2">1.2.2 SPI Theory of Operation</h3>
<p>SPI requires four signals: clock (SCLK), master output/slave input (MOSI), master input/slave output (MISO), slave select (SS).</p>
<div id="fig.spi-01" class="figure"><center><img src="/media/docs/aardvark_man/spi-01.png" alt="" /></center>
<div><strong> Figure 3</strong> : Sample SPI Implementation. – Each slave device requires a separate slave select signal (SS). This means that as devices are added, the circuit increases in complexity.</div>
</div>
<p>Three signals are shared by all devices on the SPI bus: SCLK, MOSI and MISO. SCLK is generated by the master device and is used for synchronization. MOSI and MISO are the data lines. The direction of transfer is indicated by their names. Data is always transferred in both directions in SPI, but an SPI device interested in only transmitting data can choose to ignore the receive bytes. Likewise, a device only interested in the incoming bytes can transmit dummy bytes.</p>
<p>Each device has its own SS line. The master pulls low on a slaves SS line to select a device for communication.</p>
<p>The exchange itself has no pre-defined protocol. This makes it ideal for data-streaming applications. Data can be transferred at high speed, often into the range of the tens of megahertz. The flipside is that there is no acknowledgment, no flow control, and the master may not even be aware of the slave's presence.</p>
<h3 id="s1.2.3">1.2.3 SPI Modes</h3>
<p>Although there is no protocol, the master and slave need to agree about the data frame for the exchange. The data frame is described by two parameters: clock polarity (CPOL) and clock phase (CPHA). Both parameters have two states which results in four possible combinations. These combinations are shown in figure <a href="#fig.spi-02">4</a>.</p>
<div id="fig.spi-02" class="figure"><center><img src="/media/docs/aardvark_man/spi-02.png" alt="" /></center>
<div><strong> Figure 4</strong> : SPI Modes – The frame of the data exchange is described by two parameters, the clock polarity (CPOL) and the clock phase (CPHA). This diagram shows the four possible states for these parameters and the corresponding mode in SPI.</div>
</div>
<h3 id="s1.2.4">1.2.4 SPI Benefits and Drawbacks</h3>
<p>SPI is a very simple communication protocol. It does not have a specific high-level protocol which means that there is almost no overhead. Data can be shifted at very high rates in full duplex. This makes it very simple and efficient in a single-master single-slave scenario.</p>
<p>Because each slave needs its own SS, the number of traces required is <tt>n+3</tt>, where <tt>n</tt> is the number of SPI devices. This means increased board complexity when the number of slaves is increased.</p>
<h3 id="s1.2.5">1.2.5 SPI References</h3>
<ul>
<li><a href="http://www.embedded.com/story/OEG20020124S0116">Introduction to Serial Peripheral Interface</a> – <em>Embedded.com </em></li>
<li><a href="http://www.mct.net/faq/spi.html">SPI – Serial Peripheral Interface</a></li>
</ul>
<h1 id="s2">2 Hardware Specifications</h1>
<p>The specifications defined in this section are for the Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span>/SPI Host Adapter. The Aardvark OEM adapters have a subset of these features. The Aardvark OEM <span style="white-space: nowrap;">I<sup>2</sup>C</span> Host Adapter is an <span style="white-space: nowrap;">I<sup>2</sup>C</span> master capable of speeds up to 125 kbps. The Aardvark OEM SPI Host Adapter is an SPI master capable of speeds up to 1 Mbps. Neither OEM adapter provides slave capabilities.</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s2.1">2.1 Pinouts</h2>
<h3 id="s2.1.1">2.1.1 Connector Specification</h3>
<p>The ribbon cable is a standard 10-wire 0.050″ (1.25 mm) pitch cable that is 5.125″ (131mm) long.</p>
<p>The ribbon cable connector is a standard 0.100″ (2.54 mm) pitch IDC type connector. This connector will mate with a standard keyed boxed header.</p>
<p>Alternatively, a split cable is available which connects to the ribbon cable and provides individual leads for each pin.</p>
<h3 id="s2.1.2">2.1.2 Orientation</h3>
<p>The ribbon cable pin order follows the standard convention. The red line indicates the first position. When looking at your Aardvark adapter in the upright position (figure <a href="#fig.cable-01">5</a> ), pin 1 is in the top left corner and pin 10 is in the bottom right corner.</p>
<div id="fig.cable-01" class="figure"><center><img src="/media/docs/aardvark_man/cable-01.png" alt="" /></center>
<div><strong> Figure 5</strong> : The Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span>/SPI Host Adapter in the upright position. – Pin 1 is located in the upper left corner of the connector and Pin 10 is located in the lower right corner of the connector.</div>
</div>
<p>If you flip your Aardvark adapter over (figure <a href="#fig.cable-02">6</a> ) such that the text on the serial number label is in the proper upright position, the pin order is as shown in the following diagram.</p>
<div id="fig.cable-02" class="figure"><center><img src="/media/docs/aardvark_man/cable-02.png" alt="" /></center>
<div><strong> Figure 6</strong> : The Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span>/SPI Host Adapter in the upside down position. – Pin 1 is located in the lower left corner of the connector and Pin 10 is located in the upper right corner of the connector.</div>
</div>
<h3 id="s2.1.3">2.1.3 Order of Leads</h3>
<ol>
<li>SCL</li>
<li>GND</li>
<li>SDA</li>
<li>NC/+5V</li>
<li>MISO</li>
<li>NC/+5V</li>
<li>SCLK</li>
<li>MOSI</li>
<li>SS</li>
<li>GND</li>
</ol>
<h3 id="s2.1.4">2.1.4 Ground</h3>
<p><strong>GND (Pin 2): <br /> GND (Pin 10):</strong></p>
<p>It is imperative that the Aardvark adapter be on a common ground with the target system. If the grounds are not connected, the signaling is entirely unpredictable and communication will likely be corrupted. Two pins are connected to provide a solid ground path.</p>
<h3 id="s2.1.5">2.1.5 <span style="white-space: nowrap;">I<sup>2</sup>C</span> Pins</h3>
<p><strong>SCL (Pin 1):</strong></p>
<p>Serial Clock line – the signal used to synchronize communication between the master and the slave.</p>
<p><strong>SDA (Pin 3):</strong></p>
<p>Serial Data line – the signal used to transfer data between the transmitter and the receiver.</p>
<h3 id="s2.1.6">2.1.6 SPI Pins</h3>
<p><strong>SCLK (Pin 7):</strong></p>
<p>Serial Clock – control line that is driven by the master and regulates the flow of the data bits.</p>
<p><strong>MOSI (Pin 8):</strong></p>
<p>Master Out Slave In – this data line supplies output data from the master which is shifted into the slave.</p>
<p><strong>MISO (Pin 5):</strong></p>
<p>Master In Slave Out – this data line supplies the output data from the slave to the input of the master.</p>
<p><strong>SS (Pin 9):</strong></p>
<p>Slave Select – control line that allows slaves to be turned on and off via hardware control.</p>
<h3 id="s2.1.7">2.1.7 Powering Downstream Devices</h3>
<p>It is possible to power a downstream target, such as an <span style="white-space: nowrap;">I<sup>2</sup>C</span> or SPI EEPROM with the Aardvark adapters power (which is provided by the USB port). It is ideal if the downstream device does not consume more than 25 mA per pin. The Aardvark adapter is compatible with USB hubs as well as USB host controllers (see section below on USB compliance). USB hubs are technically only rated to provide 100 mA per USB device. If the Aardvark adapter is directly plugged into a USB host controller, it can theoretically draw up to 500 mA total, leaving approximately 400 mA for any downstream target. However, the Aardvark adapter always reports itself to the host as a low-power device (&lt;100 mA). Therefore, drawing large amounts of current from the host is not advisable.</p>
<p><strong>NC/+5V (Pin 4): <span style="white-space: nowrap;">I<sup>2</sup>C</span> Power <br /> NC/+5V (Pin 6): SPI Power</strong></p>
<p>By default, these pins are left unconnected at the time of shipping. For hardware versions 2.00 and greater, these pins are switched through the software API. A maximum of 25 mA may be drawn from each pin.</p>
<p>For hardware versions prior to 2.00, power cannot be supplied unless the appropriate jumpers are connected inside the Aardvark unit. To connect VDD to pins 4 and 6, connect jumpers J301 and J302.</p>
<p>Opening your Aardvark unit will void any hardware warranty. Any modifications are at the user's own risk.</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s2.2">2.2 Signal Levels/Voltage Ratings</h2>
<h3 id="s2.2.1">2.2.1 Logic High Levels</h3>
<p>All signal levels are nominally 3.3 volts (+/- 10%) logic high. This allows the Aardvark adapter to be used with both TTL and CMOS logic level devices. A logic high of 3.3 volts will be adequate for TTL-compliant devices since such devices are ordinarily specified to accept logic high inputs above approximately 3 volts.</p>
<h3 id="s2.2.2">2.2.2 ESD protection</h3>
<p>The Aardvark adapter has built-in electrostatic discharge protection to prevent damage to the unit from high voltage static electricity.</p>
<h3 id="s2.2.3">2.2.3 Input Current</h3>
<p>All inputs are high-impedance so the input current is approximately 1 µA.</p>
<h3 id="s2.2.4">2.2.4 Drive Current</h3>
<p>The Aardvark adapter can drive all output signals with a maximum of 10 mA current source or sink. It may be possible to exceed this for short periods of time, but drawing more than 20mA may damage the I/O buffers.</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s2.3">2.3 <span style="white-space: nowrap;">I<sup>2</sup>C</span> Signaling Characteristics</h2>
<h3 id="s2.3.1">2.3.1 Speed</h3>
<p>As of hardware version 3.00, the Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> master can operate at a maximum bitrate of 800 kbps and supports many intermediate bitrates between 1 kHz and the maximum. The power-on default bitrate is for the <span style="white-space: nowrap;">I<sup>2</sup>C</span> master unit is 100 kbps.</p>
<p>For slave functionality, the Aardvark adapter can operate at any rate less than the maximum bitrate of 800 kbps.</p>
<p>For hardware versions before 3.00, the maximum <span style="white-space: nowrap;">I<sup>2</sup>C</span> master bitrate is 663 kbps and the maximum <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave bitrate is 595 kbps.</p>
<p>It is not possible to send bytes at a throughput of exactly 1/8 times the bitrate. The <span style="white-space: nowrap;">I<sup>2</sup>C</span> protocol requires that 9 bits are sent for every 8 bits of data. There is also a finite time required to set up a byte transmission. In the development of the Aardvark adapter, many optimizations have been employed to decrease this setup time. This allows byte throughputs within each transaction to be very close to the theoretical maximum byte throughput of 1/9 the bitrate.</p>
<p>There can be extra overhead introduced by the operating system between calls to the Aardvark API. These delays will further reduce the overall throughput across multiple transactions. To achieve the fastest throughput, it is advisable to send as many bytes as possible in a single transaction (i.e., a single call to the Aardvark API).</p>
<h3 id="s2.3.2">2.3.2 Pull-up Resistors</h3>
<p>There is a 2.2K resistor on each <span style="white-space: nowrap;">I<sup>2</sup>C</span> line (SCL, SDA). The lines are effectively pulled up to 3.3V, resulting in approximately 1.5 mA of pull-up current. If the Aardvark adapter is connected to an <span style="white-space: nowrap;">I<sup>2</sup>C</span> bus that also includes pull-up resistors, the total pull-up current could be potentially larger. The <span style="white-space: nowrap;">I<sup>2</sup>C</span> specification allows for a maximum of 3 mA pull-up current on each <span style="white-space: nowrap;">I<sup>2</sup>C</span> line.</p>
<p>A good rule of thumb is that if a downstream <span style="white-space: nowrap;">I<sup>2</sup>C</span> device can sink more than 5 mA of current, the protocol should operate properly. Stronger pull-up resistors and larger sink currents may be required for fast bitrates, especially if there is a large amount of capacitance on the bus. The Aardvark device is able to sink approximately 10 mA, so it is possible to have two Aardvark devices communicate with each other as master and slave, with both devices pull-up resistors enabled.</p>
<p>Hardware versions 2.00 and later have the ability to switch the pull-up resistors by through the software. Refer to the API section for more details.</p>
<h3 id="s2.3.3">2.3.3 <span style="white-space: nowrap;">I<sup>2</sup>C</span> Clock Stretching</h3>
<p>When the Aardvark adapter is configured as an <span style="white-space: nowrap;">I<sup>2</sup>C</span> master, it supports both inter-bit and inter-byte slave clock-stretching. If a slave device pulls SCL low during a transaction, the adapter will wait until SCL has been released before continuing with the transaction.</p>
<h3 id="s2.3.4">2.3.4 Known <span style="white-space: nowrap;">I<sup>2</sup>C</span> Limitations</h3>
<p>Since firmware version 2.00, the Aardvark adapter supports the repeated start, 10-bit addressing, and combined format features of the <span style="white-space: nowrap;">I<sup>2</sup>C</span> protocol.</p>
<p>Since firmware version 3.00, the Aardvark adapter can keep the slave functions enabled even while master operations are executed through the same adapter. The Aardvark adapter can even respond to slave requests immediately after losing bus arbitration during the slave addressing phase of a master transaction.</p>
<p>Multi-master is also supported with the following features:</p>
<ol>
<li>If there is a bus collision during data transmission and the Aardvark adapter loses the bus, the transaction will be be cut short and the host API will report that fewer bytes were transmitted than the requested number. This condition can be distinguished from the case in which the downstream slave cuts short the transmission by sending a NACK by using the function <tt>aa_i2c_read_ext</tt>.</li>
<li>Collisions are not detected in the following situations:
<ul>
<li>Between a REPEATED START condition and a data bit</li>
<li>Between a STOP condition and a data bit</li>
<li>Between a REPEATED START and a STOP condition</li>
</ul>
</li>
</ol>
<p>This constraint can be phrased in a different manner. Say that <span style="white-space: nowrap;">I<sup>2</sup>C</span> master device <strong>A</strong> has a packet length of <strong>X</strong> bytes. If there is a second <span style="white-space: nowrap;">I<sup>2</sup>C</span> master device, <strong>B</strong>, that sends packets of length greater than <strong>X</strong> bytes, the first <strong>X</strong> bytes should never contain exactly the same data as the data sent by device <strong>A</strong>. Otherwise the results of the arbitration will be undefined.</p>
<p>This is a constraint found with most <span style="white-space: nowrap;">I<sup>2</sup>C</span> master devices used in a multi-master environment.</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s2.4">2.4 SPI Signaling Characteristics</h2>
<h3 id="s2.4.1">2.4.1 SPI Waveforms</h3>
<p>The SPI signaling is characterized by the waveforms in Figures <a href="#fig.spi-03">7</a> and <a href="#fig.spi-04">8</a>.</p>
<div id="fig.spi-03" class="figure"><center><img src="/media/docs/aardvark_man/spi-03.png" alt="" /></center>
<div><strong> Figure 7</strong> : SPI Waveform – Three different times are of note: t <sub><small>1</small></sub>, time from the assertion of SS# to the first clock cycle; t <sub><small>2</small></sub>, time from the last clock cycle and the deassertion of SS#; t <sub><small>p</small></sub>, clock period.</div>
</div>
<div id="fig.spi-04" class="figure"><center><img src="/media/docs/aardvark_man/spi-04.png" alt="" /></center>
<div><strong> Figure 8</strong> : SPI Byte Timing – t <sub><small>d</small></sub> is the setup time between SPI bytes and t <sub><small>b</small></sub> is the total byte-to-byte time.</div>
</div>
<div id="table.spi_timing"><center>
<div><strong>Table 1</strong> : SPI Timing Parameters</div>
<table cellspacing="4">
<tbody>
<tr>
<td><strong>Symbol</strong></td>
<td><strong>Parameter</strong></td>
<td class="right"><strong>Min</strong></td>
<td class="right"><strong>Max</strong></td>
<td class="center"><strong>Units</strong></td>
</tr>
<tr>
<td>t<sub><small>1</small></sub></td>
<td>SS# assertion to first clock</td>
<td class="right">10</td>
<td class="right">20</td>
<td class="center">µs</td>
</tr>
<tr>
<td>t<sub><small>2</small></sub></td>
<td>Last clock to SS# deassertion</td>
<td class="right">5</td>
<td class="right">10</td>
<td class="center">µs</td>
</tr>
<tr>
<td>t<sub><small>p</small></sub></td>
<td>Clock period</td>
<td class="right">125</td>
<td class="right">8000</td>
<td class="center">ns</td>
</tr>
<tr>
<td>t<sub><small>d</small></sub></td>
<td>Setup time (Master)</td>
<td class="right">7</td>
<td class="right">9</td>
<td class="center">µs</td>
</tr>
<tr>
<td>t<sub><small>d</small></sub></td>
<td>Setup time (Slave)</td>
<td class="right">4</td>
<td class="right">n/a</td>
<td class="center">µs</td>
</tr>
<tr>
<td>t<sub><small>b</small></sub></td>
<td>Time between start of bytes (Slave)</td>
<td class="right">10</td>
<td class="right">n/a</td>
<td class="center">µs</td>
</tr>
</tbody>
</table>
</center></div>
<h3 id="s2.4.2">2.4.2 Speeds</h3>
<p>The Aardvark SPI master can operate at bitrates between 125 kHz and 8 MHz, including, but not limited to the following frequencies: 125 kHz, 250 kHz, 500 kHz, 1 MHz, 2 MHz, 4 MHz, and 8 MHz. The power-on default bitrate is 1 MHz. The quoted bitrates are only achievable within each individual byte and does not extend across bytes. There is approximately 9 µs of setup time required in between each byte which results in a total transmission period of the byte transmission time plus 9 µs.</p>
<p>The Aardvark SPI slave can operate at any bitrate up to 4 Mbps. However, for correct transmission from slave to master there must be at least 4 µs delay between the end of byte <strong>n</strong> and start of byte <strong>n+1</strong> for the MISO data to be setup properly for byte <strong>n+1</strong>. Otherwise, the Aardvark adapter will simply return the data it just received. Likewise, for correct reception of data by the slave, there must be at least 10 µs between the start of byte <strong>n</strong> and the start of byte <strong>n+1</strong>.</p>
<p>Similarly, when the Aardvark adapter is configured to act as an SPI slave, and the slave select is pulled high to indicate the end of a transaction, there is a data processing overhead of sending the transaction to the PC host. As such, if the SPI master sends a subsequent transaction in rapid succession to the Aardvark slave, the data received by the Aardvark slave may be corrupted. There is no precise value for this minimum inter-transaction time, but a suggested spacing is approximately 100-200 µs.</p>
<h3 id="s2.4.3">2.4.3 Pin Driving</h3>
<p>When the SPI interface is activated as a master, the slave select line (SS) is actively driven low. The MOSI and SCK lines are driven as appropriate for the SPI mode. After each transmission is complete, these lines are returned to a high impedance state. This feature allows the Aardvark adapter, following a transaction as a master SPI device, to be then reconnected to another SPI environment as a slave. The Aardvark adapter will not fight the master lines in the new environment.</p>
<p>Consequently, any SPI slave target to which the Aardvark adapter is interfaced must have a pull-up resistor on its slave select line, preventing fluttering of the voltage when the Aardvark adapter stops driving the signal. It is also advisable that every slave also have passive pull-ups on the MOSI and SCK lines. These pull-up resistors can be relatively weak – 100k should be adequate.</p>
<p>As a slave, the MOSI, SCK, and SS lines are configured as an input and the MISO line is configured as an output. This configuration is held as long as the slave mode is enabled (see the API documentation later in the manual).</p>
<h3 id="s2.4.4">2.4.4 Known SPI Limitations</h3>
<p>There is currently an issue with SPI mode 2 (clock idles high, and sampling of MOSI is on the leading edge) that induces periodic bit corruptions in the most significant bit of certain bytes. The bug has been noted for SPI slave devices and there may also be corruptions when using this mode for sending or receiving messages as an SPI master. Unfortunately there is no fix for this problem and the best solution is to use another mode. If you have any questions regarding this issue please contact Total Phase support.</p>
<p>It is only possible to reliably send and receive transactions of 4 KiB or less as an SPI master or slave. This is due to operating system issues and the full-duplex nature of the SPI signaling.</p>
<h3 id="s2.4.5">2.4.5 Aardvark Device Power Consumption</h3>
<p>The Aardvark adapter consumes less than 100 mA of current. This is within the USB 1.1 current specification for devices powered from a USB host adapter (500 mA maximum per device) or a USB hub (100 mA maximum per device).</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s2.5">2.5 USB 1.1 Compliance</h2>
<p>The Aardvark adapter is USB 1.1 compliant and will also operate as a full speed (12 Mbps) device on a USB 2.0 hub or host controller</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s2.6">2.6 Physical Specifications</h2>
<ul>
<li>Dimensions: W x D x L: 55.6 mm x 22.2 mm x 89 mm (2.19" x 0.87" x 3.5")</li>
<li>Weight: 64 g (0.14 lbs)</li>
</ul>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s2.7">2.7 Temperature Specifications</h2>
<p>The Aardvark device is designed to be operated at room temperature (10-35 C). The electronic components are rated for standard commercial specifications (0-70 C). However, the plastic housing, along with the ribbon and USB cables, may not withstand the higher end of this range. Any use of the Aardvark device outside the room temperature specification will void the hardware warranty.</p>
<h1 id="s3">3 Software</h1>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s3.1">3.1 Compatibility</h2>
<h3 id="s3.1.1">3.1.1 Overview</h3>
<p>The Aardvark software is offered as a 32-bit or 64-bit Dynamic Linked Library (or shared object). The specific compatibility for each operating system is discussed below. Be sure the device driver has been installed before plugging in the Aardvark adapter.</p>
<h3 id="s3.1.2">3.1.2 Windows Compatibility</h3>
<p>The Aardvark software is compatible with 32-bit and 64-bit versions of Windows XP (SP2 or later), Windows Vista, Windows 7, and Windows 8/8.1.</p>
<p>Windows 2000 and legacy 16-bit Windows 95/98/ME operating systems are not supported.</p>
<h3 id="s3.1.3">3.1.3 Linux Compatibility</h3>
<p>The Aardvark software is compatible with all standard 32-bit and 64-bit distributions of Linux with kernel 2.6 and integrated USB support. When using the 32-bit library on a 64-bit distribution, the appropriate 32-bit system libraries are also required.</p>
<h3 id="s3.1.4">3.1.4 Mac OS X Compatibility</h3>
<p>The Aardvark software is compatible with Intel versions of Mac OS X 10.5 Leopard, 10.6 Snow Leopard, 10.7 Lion, 10.8 Mountain Lion, and 10.9 Mavericks. Installation of the latest available update is recommended.</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s3.2">3.2 Windows USB Driver</h2>
<h3 id="s3.2.1">3.2.1 Driver Installation</h3>
<p>As of version 3.0, the Aardvark communications layer under Windows no longer uses a virtual serial port driver. The switch to a more direct USB driver should improve the installation and performance of PC and Aardvark adapter communication.</p>
<p>To install the appropriate USB communication driver under Windows, use the Total Phase USB Driver Installer before plugging in any device. The driver installer can be found either on the CD-ROM (use the HTML based guide that is opened when the CD is first loaded to locate the Windows installer), or in the Downloads section of the Aardvark adapter product page on the Total Phase website.</p>
<p>After the driver has been installed, plugging in an Aardvark adapter for the first time will cause the adapter to be installed and associated with the correct driver. The following steps describe the feedback the user should receive from Windows after an Aardvark adapter is plugged into a system for the first time:</p>
<p><strong>Windows XP:</strong></p>
<ol>
<li>The Found New Hardware notification bubble will pop up from the system tray and state that the Total Phase Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span>/SPI Host Adapter has been detected.</li>
<li>When the installation is complete, the Found New Hardware notification bubble will again pop up and state that your new hardware is installed and ready to use.</li>
</ol>
<p><strong>Windows Vista/7/8:</strong></p>
<ol>
<li>A notification bubble will pop up from the system tray and state that Windows is "installing device driver software."</li>
<li>When the installation is complete, the notification bubble will again pop up and state that the "device driver software installed successfully."</li>
</ol>
<p>To confirm that the device was correctly installed, check that the device appears in the "Device Manager." To navigate to the "Device Manager"screen, select "Control Panel | System Properties | Hardware | Device Manager" for Windows XP, or select "Control Panel | Hardware and Sound | Device Manager" for Windows Vista/7/8. The Aardvark device should appear under the Universal Serial Bus Controllers section.</p>
<h3 id="s3.2.2">3.2.2 Driver Removal</h3>
<p>The USB communication driver can be removed from the operating system by using the Windows program removal utility. Instructions for using this utility can be found below. Alternatively, the Uninstall option found in the driver installer can also be used to remove the driver from the system.</p>
<p><strong>NOTE:</strong> It is critical to remove all Total Phase devices from your system before you remove the USB drivers.</p>
<p><strong>Windows XP:</strong></p>
<ol>
<li>Select "Control Panel | Add or Remove Programs"</li>
<li>Select "Total Phase USB Driver "and select "Change/Remove"</li>
<li>Follow the instructions in the uninstaller</li>
</ol>
<p><strong>Windows Vista/7/8:</strong></p>
<ol>
<li>Select "Control Panel | Uninstall a program"</li>
<li>Right-click on "Total Phase USB Driver" and select "Uninstall/Change"</li>
<li>Follow the instructions in the uninstaller</li>
</ol>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s3.3">3.3 Linux USB Driver</h2>
<p>As of version 5.15, the Aardvark communications layer under Linux no longer requires a specific kernel mode or user mode driver to operate. This differs from previous versions that required the user to ensure independently that the libusb library was installed on the system. See the README.txt in the API package for more details.</p>
<p>Most modern Linux distributions use the udev subsystem to help manipulate the permissions of various system devices. This is the preferred way to support access to the Aardvark adapter such that the device is accessible by all of the users on the system upon device plug-in.</p>
<p>For legacy systems, there are two different ways to access the Aardvark adapter, through USB hotplug or by mounting the entire USB filesystem as world writable. Both require that <tt>/proc/bus/usb</tt> is mounted on the system which is the case on most standard distributions.</p>
<h3 id="s3.3.1">3.3.1 UDEV</h3>
<p>Support for udev requires a single configuration file that is available on the software CD, and also listed on the Total Phase website for download. This file is <tt>99-totalphase.rules</tt>. Please follow the following steps to enable the appropriate permissions for the Aardvark adapter.</p>
<ol>
<li>As superuser, unpack <tt>99-totalphase.rules</tt> to <tt>/etc/udev/rules.d</tt></li>
<li><tt>chmod 644 /etc/udev/rules.d/99-totalphase.rules</tt></li>
<li>Unplug and replug your Aardvark adapter(s)</li>
</ol>
<h3 id="s3.3.2">3.3.2 USB Hotplug</h3>
<p>USB hotplug requires two configuration files which are available on the software CD, and also listed on the Total Phase website for download. These files are: <tt>aardvark</tt> and <tt>aardvark.usermap</tt>. Please follow the following steps to enable hotplugging.</p>
<ol>
<li>As superuser, unpack <tt>aardvark</tt> and <tt>aardvark.usermap</tt> to <tt>/etc/hotplug/usb</tt></li>
<li><tt>chmod 755 /etc/hotplug/usb/aardvark</tt></li>
<li><tt>chmod 644 /etc/hotplug/usb/aardvark.usermap</tt></li>
<li>Unplug and replug your Aardvark adapter(s)</li>
<li>Set the environment variable <tt>USB_DEVFS_PATH</tt> to <tt>/proc/bus/usb</tt></li>
</ol>
<h3 id="s3.3.3">3.3.3 World-Writable USB Filesystem</h3>
<p>Finally, here is a last-ditch method for configuring your Linux system in the event that your distribution does not have udev or hotplug capabilities. The following procedure is not necessary if you were able to exercise the steps in the previous subsections.</p>
<p>Often, the <tt>/proc/bus/usb</tt> directory is mounted with read-write permissions for root and read-only permissions for all other users. If an non-privileged user wishes to use the Aardvark adapter and software, one must ensure that <tt>/proc/bus/usb</tt> is mounted with read-write permissions for all users. The following steps can help setup the correct permissions. Please note that these steps will make the entire USB filesystem world writable.</p>
<ol>
<li>Check the current permissions by executing the following command: <br /> <tt>ls -al /proc/bus/usb/001</tt></li>
<li>If the contents of that directory are only writable by root, proceed with the remaining steps outlined below.</li>
<li>Add the following line to the <tt>/etc/fstab</tt> file:
<pre>none /proc/bus/usb usbfs defaults,devmode=0666 0 0</pre>
</li>
<li>Unmount the <tt>/proc/bus/usb</tt> directory using <tt>umount</tt></li>
<li>Remount the <tt>/proc/bus/usb</tt> directory using <tt>mount</tt></li>
<li>Repeat step 1. Now the contents of that directory should be writable by all users.</li>
<li>Set the environment variable <tt>USB_DEVFS_PATH</tt> to <tt>/proc/bus/usb</tt></li>
</ol>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s3.4">3.4 Mac OS X USB Driver</h2>
<p>The Aardvark communications layer under Mac OS X does not require a specific kernel driver to operate. Both Mac OS X 10.4 Tiger and 10.5 Leopard are supported. It is typically necessary to ensure that the user running the software is currently logged into the desktop. No further user configuration should be necessary.</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s3.5">3.5 USB Port Assignment</h2>
<p>The Aardvark adapter is assigned a port on a sequential basis. The first adapter is assigned to port 0, the second is assigned to port 1, and so on. If an Aardvark adapter is subsequently removed from the system, the remaining adapters shift their port numbers accordingly. With <strong>n</strong> Aardvark adapters attached, the allocated ports will be numbered from <strong>0</strong> to <strong>n-1</strong>.</p>
<h3 id="s3.5.1">3.5.1 Detecting Ports</h3>
<p>To determine the ports to which the Aardvark adapters have been assigned, use the <tt>aa_find_devices</tt> routine as described in following API documentation.</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s3.6">3.6 Aardvark Dynamically Linked Library</h2>
<h3 id="s3.6.1">3.6.1 DLL Philosophy</h3>
<p>The Aardvark DLL provides a robust approach to allow present-day Aardvark-enabled applications to interoperate with future versions of the device interface software without recompilation. For example, take the case of a graphical application that is written to communicate <span style="white-space: nowrap;">I<sup>2</sup>C</span> or SPI through an Aardvark device. At the time the program is built, the Aardvark software is released as version 1.2. The Aardvark interface software may be improved many months later resulting in increased performance and/or reliability; it is now released as version 1.3. The original application need not be altered or recompiled. The user can simply replace the old Aardvark DLL with the newer one. How does this work? The application contains only a stub which in turn dynamically loads the DLL on the first invocation of any Aardvark API function. If the DLL is replaced, the application simply loads the new one, thereby utilizing all of the improvements present in the replaced DLL.</p>
<p>On Linux and Mac OS X, the DLL is technically known as a shared object (SO).</p>
<h3 id="s3.6.2">3.6.2 DLL Location</h3>
<p>Total Phase provides language bindings that can be integrated into any custom application. The default behavior of locating the Aardvark DLL is dependent on the operating system platform and specific programming language environment. For example, for a C or C++ application, the following rules apply:</p>
<p>On a Windows system, this is as follows:</p>
<ol>
<li>The directory from which the application binary was loaded.</li>
<li>The applications current directory.</li>
<li>32-bit system directory (for a 32-bit application). Examples:
<ul>
<li><tt>c:\Windows\System32</tt> [Windows XP/Vista/7/8 32-bit]</li>
<li><tt>C:\Windows\System64</tt> [Windows XP 64-bit]</li>
<li><tt>c:\Windows\SysWow64</tt> [Windows Vista/7/8 64-bit]</li>
</ul>
</li>
<li>64-bit system directory (for a 64-bit application). Examples:
<ul>
<li><tt>C:\Windows\System32</tt> [Windows XP/Vista/7/8 64-bit]</li>
</ul>
</li>
<li>The Windows directory. (Ex: <tt>c:\Windows</tt> )</li>
<li>The directories listed in the PATH environment variable.</li>
</ol>
<p>On a Linux system, this is as follows:</p>
<ol>
<li>First, search for the shared object in the application binary path. If the <tt>/proc</tt> filesystem is not present, this step is skipped.</li>
<li>Next, search in the applications current working directory.</li>
<li>Search the paths explicitly specified in <tt>LD_LIBRARY_PATH</tt>.</li>
<li>Finally, check any system library paths as specified in <tt>/etc/ld.so.conf</tt> and cached in <tt>/etc/ld.so.cache</tt>.</li>
</ol>
<p>On a Mac OS X system, this is as follows:</p>
<ol>
<li>First, search for the shared object in the application binary path.</li>
<li>Next, search in the applications current working directory.</li>
<li>Search the paths explicitly specified in <tt>DYLD_LIBRARY_PATH</tt>.</li>
<li>Finally, check the /usr/lib and /usr/local/lib system library paths.</li>
</ol>
<p>If the DLL is still not found, an error will be returned by the binding function. The error code is <tt>AA_UNABLE_TO_LOAD_LIBRARY</tt>.</p>
<h3 id="s3.6.3">3.6.3 DLL Versioning</h3>
<p>The Aardvark DLL checks to ensure that the firmware of a given Aardvark device is compatible. Each DLL revision is tagged as being compatible with firmware revisions greater than or equal to a certain version number. Likewise, each firmware version is tagged as being compatible with DLL revisions greater than or equal to a specific version number.</p>
<p>Here is an example.</p>
<pre>      DLL v1.20: compatible with Firmware &gt;= v1.15
      Firmware v1.30: compatible with DLL &gt;= v1.20
    </pre>
<p>Hence, the DLL is not compatible with any firmware less than version 1.15 and the firmware is not compatible with any DLL less than version 1.20. In this example, the version number constraints are satisfied and the DLL can safely connect to the target firmware without error. If there is a version mismatch, the API calls to open the device will fail. See the API documentation for further details.</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s3.7">3.7 Rosetta Language Bindings: API Integration into Custom Applications</h2>
<h3 id="s3.7.1">3.7.1 Overview</h3>
<p>The Aardvark Rosetta language bindings make integration of the Aardvark API into custom applications simple. Accessing Aardvark functionality simply requires function calls to the Aardvark API. This API is easy to understand, much like the ANSI C library functions, (e.g., there is no unnecessary entanglement with the Windows messaging subsystem like development kits for some other embedded tools).</p>
<p>First, choose the Rosetta bindings appropriate for the programming language. Different Rosetta bindings are included with the software distribution on the distribution CD. They can also be found in the software download package available on the Total Phase website. Currently the following languages are supported: C/C++, Python, Visual Basic 6, Visual Basic .NET, and C#. Next, follow the instructions for each language binding on how to integrate the bindings with your application build setup. As an example, the integration for the C language bindings is described below. (For information on how to integrate the bindings for other languages, please see the example code included on the distribution CD and also available for download on the Total Phase website.)</p>
<ol>
<li>Include the <tt>aardvark.h</tt> file included with the API software package in any C or C++ source module. The module may now use any Aardvark API call listed in <tt>aardvark.h</tt>.</li>
<li>Compile and link <tt>aardvark.c</tt> with your application. Ensure that the include path for compilation also lists the directory in which <tt>aardvark.h</tt> is located if the two files are not placed in the same directory.</li>
<li>Place the Aardvark DLL, included with the API software package, in the same directory as the application executable or in another directory such that it will be found by the previously described search rules.</li>
</ol>
<h3 id="s3.7.2">3.7.2 Versioning</h3>
<p>Since a new Aardvark DLL can be made available to an already compiled application, it is essential to ensure the compatibility of the Rosetta binding used by the application (e.g., <tt>aardvark.c</tt> ) against the DLL loaded by the system. A system similar to the one employed for the DLL-Firmware cross-validation is used for the binding and DLL compatibility check.</p>
<p>Here is an example.</p>
<pre>      DLL v1.20: compatible with Binding &gt;= v1.10
      Binding v1.15: compatible with DLL &gt;= v1.15
    </pre>
<p>The above situation will pass the appropriate version checks. The compatibility check is performed within the binding. If there is a version mismatch, the API function will return an error code, <tt>AA_INCOMPATIBLE_LIBRARY</tt>.</p>
<h3 id="s3.7.3">3.7.3 Customizations</h3>
<p>While provided language bindings stubs are fully functional, it is possible to modify the code found within this file according to specific requirements imposed by the application designer.</p>
<p>For example, in the C bindings one can modify the DLL search and loading behavior to conform to a specific paradigm. See the comments in <tt>aardvark.c</tt> for more details.</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s3.8">3.8 Application Notes</h2>
<h3 id="s3.8.1">3.8.1 Asynchronous Messages</h3>
<p>There is buffering within the Aardvark DLL, on a per-device basis, to help capture asynchronous messages. Take the case of the Aardvark adapter receiving <span style="white-space: nowrap;">I<sup>2</sup>C</span> messages asynchronously. If the application calls the function to change the SPI bitrate while some unprocessed asynchronous messages are pending, the Aardvark adapter will transact the bitrate change but also save any pending <span style="white-space: nowrap;">I<sup>2</sup>C</span> messages internally. The messages will be held until the appropriate API function is called.</p>
<p>The size of the <span style="white-space: nowrap;">I<sup>2</sup>C</span> and SPI buffers are 16 KiB each and they can hold many separate transactions. The buffers are only used when an Aardvark API call is invoked. The buffer size is adequate since the overall limitation for asynchronous messages is fundamentally determined by the operating systems internal buffer size. This concept is explained below.</p>
<h3 id="s3.8.2">3.8.2 Receive Saturation</h3>
<p>The Aardvark adapter can be configured as an <span style="white-space: nowrap;">I<sup>2</sup>C</span> or SPI slave. A slave can receive messages asynchronously with respect to the host PC software. Between calls to the Aardvark API, these messages must be buffered somewhere in memory. This is accomplished on the PC host, courtesy of the operating system. Naturally the buffer is limited in size and once this buffer is full, bytes will be dropped.</p>
<p>An overflow can occur when the Aardvark device receives asynchronous messages faster than the rate that they are processed – the receive link is saturated. This condition can affect other synchronous communication with the Aardvark adapter. For example, if the SPI slave is receiving many unserviced messages (messages left pending in the operating systems buffer), a subsequent call to change the bitrate of <span style="white-space: nowrap;">I<sup>2</sup>C</span> could fail in the following manner.</p>
<ol>
<li>The software sends a command to the Aardvark adapter to change the bitrate.</li>
<li>The Aardvark adapter responds that the bitrate was set to a given value.</li>
<li>The response is lost since the operating systems receive buffer was full.</li>
</ol>
<p>The requested bitrate has most likely been set by the Aardvark device, but the response was lost. A similar problem can happen when one attempts to disable the very slave that is saturating the incoming receive buffer! The API function sends a command to disable the slave, but the acknowledgment from the Aardvark adapter is lost. The API call will treat this as a communication error, but if the slave was actually disabled, a subsequent call to disable the slave should complete without errors.</p>
<p>The receive saturation problem can be improved in two ways. The obvious solution is to reduce the amount of traffic that is sent by the master between calls to the Aardvark API. This will require the ability to reconfigure the offending master device. The other option is to more regularly poll the slave to obtain any pending asynchronous messages. Keep in mind that each call to capture pending asynchronous data can have a timeout of up to 500 ms. If there is other time critical code that must be executed simultaneously, it is best to use the asynchronous polling function found in the API which allows for variable timeout values.</p>
<h3 id="s3.8.3">3.8.3 Threading</h3>
<p>The Aardvark DLL is designed for single-threaded environments so as to allow for maximum cross-platform compatibility. If the application design requires multi-threaded use of the Aardvark functionality, each Aardvark API call can be wrapped with a thread-safe locking mechanism before and after invocation. A call to any Aardvark API function that communicates with the host synchronously will also fetch any pending asynchronous messages, buffering them for subsequent calls to the asynchronous (slave) receive functions.</p>
<h3 id="s3.8.4">3.8.4 USB Scheduling Delays</h3>
<p>Each API call that is used to send data to and from the Aardvark adapter can incur up to 1 ms in delay on the PC host. This is caused by the inherent design of the USB architecture. The operating system will queue any outgoing USB transfer request on the host until the next USB frame period. The frame period is 1 ms. Thus, if the application attempts to execute several transactions in rapid sequence there can be 1-2 ms delay between each transaction plus any additional process scheduling delays introduced by the operating system. The best throughput can be achieved for single transactions that transfer a large number of bytes at a time.</p>
<h1 id="s4">4 Firmware</h1>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s4.1">4.1 Field Upgrades</h2>
<h3 id="s4.1.1">4.1.1 Upgrade Philosophy</h3>
<p>The Aardvark adapter is designed so that its internal firmware can be upgraded by the user, thereby allowing the inclusion of any performance enhancements or critical fixes available after the purchase of the device. The upgrade procedure is performed via USB and has several error checking facilities to ensure that the Aardvark adapter is not rendered permanently unusable by a bad firmware update. In the worst case scenario, a corruption can cause the Aardvark adapter to be locked until a subsequent clean update is executed.</p>
<p>The upgrade utility is also compatible with older devices that use the legacy virtual serial port communications drivers (pre-3.00 firmware revisions). The older serial port driver must be installed on your operating system. When listing such devices, the upgrade utility will report these devices with port numbers starting at 128. The devices will also be marked as "serial" as opposed to the "direct" identifier. Upgrading the legacy firmware will cause the Aardvark unit to automatically switch to using the new communications driver interface. If the host PC does not have the appropriate driver installed, the operating system may prompt the user for the new driver upon completion of the firmware upgrade. Please refer to the section on USB driver installation above for more information on how to install the new driver.</p>
<p>The Aardvark OEM <span style="white-space: nowrap;">I<sup>2</sup>C</span> Host Adapter and the Aardvark OEM SPI Host Adapter do not support field upgrades.</p>
<h3 id="s4.1.2">4.1.2 Upgrade Procedure</h3>
<p>Here is the simple procedure by which the Aardvark firmware is upgraded.</p>
<ol>
<li>Download the latest firmware from the Total Phase website.</li>
<li>Unzip the downloaded file. It should contain the <tt>aaflash</tt> utility. This utility contains the necessary information to perform the entire firmware update.</li>
<li>Run the appropriate version of <tt>aaflash</tt> :
<ul>
<li><tt>aaflash-win32.exe</tt> on Windows</li>
<li><tt>aaflash-linux</tt> on Linux</li>
<li><tt>aaflash-darwin</tt> on Mac OS X</li>
</ul>
<p>It will first display the firmware version contained in the utility along with the required hardware version to run this firmware version.</p>
</li>
<li>It will list all of the detected devices along with their current firmware and hardware versions.</li>
<li>Select a device to upgrade. <strong>Note the firmware and hardware version of the device before proceeding.</strong> If the selected devices hardware is not suitable to accept the new firmware, an error will be printed and the utility will be reinvoked.</li>
<li>If the chosen device is acceptable, the <tt>aaflash</tt> utility will update the device with the new firmware. The process should take about 3 seconds, with a progress bar displayed during the procedure.</li>
<li>The upgraded Aardvark adapter should now be usable by any Aardvark-enabled application.</li>
<li>In the event that there was a malfunction in the firmware update, the Aardvark adapter may not be recognizable by an Aardvark-enabled application. Try the update again, since the Aardvark adapter has most likely become locked due to a corruption in the upgrade process. If the update still does not take effect, it is best to revert back to the previous firmware. This can be done by running a previous version of <tt>aaflash</tt> that contains an earlier firmware version. Check the Total Phase website or the distribution CD that was included with your Aardvark adapter for previous versions of the firmware.</li>
</ol>
<h1 id="s5">5 API Documentation</h1>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s5.1">5.1 Introduction</h2>
<p>The API documentation that follows is oriented toward the Aardvark Rosetta C bindings. The set of API functions and their functionality is identical regardless of which Rosetta language binding is utilized. The only differences will be found in the calling convention of the functions. For further information on such differences please refer to the documentation that accompanies each language bindings in the Aardvark software distribution.</p>
<p>The Aardvark OEM <span style="white-space: nowrap;">I<sup>2</sup>C</span> Host Adapter and the Aardvark OEM SPI Host Adapter have a subset of these features. Attempting to use a feature that is not supported will result in an error.</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s5.2">5.2 General Data Types</h2>
<p>The following definitions are provided for convenience. All Aardvark data types are unsigned.</p>
<pre>      typedef unsigned char  aa_u08;
      typedef unsigned short aa_u16;
      typedef unsigned int   aa_u32;
    </pre>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s5.3">5.3 Notes on Status Codes</h2>
<p>Most of the Aardvark API functions can return a status or error code back to the caller. The complete list of status codes is provided at the end of this chapter. All of the error codes are assigned values less than 0, separating these responses from any numerical values returned by certain API functions.</p>
<p>Each API function can return one of two error codes with regard to the loading of the underlying Aardvark DLL, <tt>AA_UNABLE_TO_LOAD_LIBRARY</tt> and <tt>AA_INCOMPATIBLE_LIBRARY</tt>. If these status codes are received, refer to the previous sections in this manual that discuss the DLL and API integration of the Aardvark software. Furthermore, all API calls can potentially return the error <tt>AA_UNABLE_TO_LOAD_FUNCTION</tt>. If this error is encountered, there is likely a serious version incompatibility that was not caught by the automatic version checking system. Where appropriate, compare the language binding versions (e.g., <tt>AA_HEADER_VERSION</tt> found in <tt>aardvark.h</tt> and <tt>AA_CFILE_VERSION</tt> found in <tt>aardvark.c</tt> ) to verify that there are no mismatches. Next, ensure that the Rosetta language binding (e.g., <tt>aardvark.c</tt> and <tt>aardvark.h</tt> ) are from the same release as the Aardvark DLL. If all of these versions are synchronized and there are still problems, please contact Total Phase support for assistance.</p>
<p>Any API function that accepts an Aardvark handle can return the error <tt>AA_INVALID_HANDLE</tt> if the handle does not correspond to a valid Aardvark device that has already been opened. If this error is received, check the application code to ensure that the <tt>aa_open</tt> command returned a valid handle and that this handle is not corrupted before being passed to the offending API function.</p>
<p>Finally, any <span style="white-space: nowrap;">I<sup>2</sup>C</span> or SPI API call that communicates with an Aardvark device can return the error <tt>AA_COMMUNICATION_ERROR</tt>. This means that while the Aardvark handle is valid and the communication channel is open, there was an error receiving the acknowledgment response from the Aardvark adapter. This can occur in situations where the incoming data stream has been saturated by asynchronously received messages an outgoing message is sent to the Aardvark adapter, but the incoming acknowledgment is dropped by the operating system as a result of the incoming USB receive buffer being full. The error signifies that it was not possible to guarantee that the connected Aardvark device has processed the host PC request, though it is likely that the requested action has been communicated to the Aardvark adapter and the response was simply lost. For example, if the slave functions are enabled and the incoming communication buffer is saturated, an API call to disable the slave may return <tt>AA_COMMUNICATION_ERROR</tt> even though the slave has actually been disabled.</p>
<p>If either the <span style="white-space: nowrap;">I<sup>2</sup>C</span> or SPI subsystems have been disabled by aa_configure, all other API functions that interact with <span style="white-space: nowrap;">I<sup>2</sup>C</span> or SPI will return <tt>AA_I2C_NOT_ENABLED</tt> or <tt>AA_SPI_NOT_ENABLED</tt>, respectively.</p>
<p>These common status responses are not reiterated for each function. Only the error codes that are specific to each API function are described below.</p>
<p>All of the possible error codes, along with their values and status strings, are listed following the API documentation.</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s5.4">5.4 General</h2>
<h3 id="s5.4.1">5.4.1 Interface</h3>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.1">Find Devices (aa_find_devices)</h4>
<pre>      int aa_find_devices (int      nelem,
                           aa_u16 * devices);
    </pre>
<p class="api-desc">Get a list of ports to which Aardvark devices are attached.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>nelem</td>
<td>Maximum size of the array</td>
</tr>
<tr>
<td>devices</td>
<td>array into which the port numbers are returned</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>This function returns the number of devices found, regardless of the array size.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>Each element of the array is written with the port number. Devices that are in use are ORed with <tt>AA_PORT_NOT_FREE</tt> ( <tt>0x8000</tt> ).</p>
<p>Example:</p>
<blockquote>Devices are attached to port 0, 1, 2 <br /> ports 0 and 2 are available, and port 1 is in-use. <br /> <tt>array =&gt; 0x0000, 0x8001, 0x0002;</tt></blockquote>
<p>If the input array is NULL, it is not filled with any values.</p>
<p>If there are more devices than the array size (as specified by <tt>nelem</tt> ), only the first <tt>nelem</tt> port numbers will be written into the array.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.2">Find Devices (aa_find_devices_ext)</h4>
<pre class="api-func">      int aa_find_devices_ext (int       num_devices,
                               aa_u16 * devices,
                               int      num_ids,
                               aa_u32 * unique_ids);
    </pre>
<p class="api-desc">Get a list of ports and unique IDs to which Aardvark devices are attached.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>num_devices</td>
<td>maximum number of device port numbers to return</td>
</tr>
<tr>
<td>devices</td>
<td>array into which the device port numbers are returned</td>
</tr>
<tr>
<td>num_ids</td>
<td>maximum number of unique IDs to return</td>
</tr>
<tr>
<td>unique_ids</td>
<td>array into which the unique IDs are returned</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>This function returns the number of devices found, regardless of the array sizes.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>This function is the same as <tt>aa_find_devices()</tt> except that is also returns the unique IDs of each Aardvark device. The IDs are guaranteed to be non-zero if valid.</p>
<p>The IDs are the unsigned integer representation of the 10-digit serial numbers.</p>
<p>The number of devices and IDs returned in each of their respective arrays is determined by the minimum of <tt>num_devices</tt> and <tt>num_ids</tt>. However, if either array is <tt>NULL</tt>, the length passed in for the other array is used as-is, and the <tt>NULL</tt> array is not populated. If both arrays are <tt>NULL</tt>, neither array is populated, but the number of devices found is still returned.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.3">Open an Aardvark device (aa_open)</h4>
<pre class="api-func">      Aardvark aa_open (int port_number);
    </pre>
<p class="api-desc">Open the Aardvark port.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>port_number</td>
<td>The port is the same as the one obtained from function <tt>aa_find_devices</tt>. It is a zero-based number.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>This function returns an Aardvark handle, which is guaranteed to be greater than zero if valid.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>AA_UNABLE_TO_OPEN</td>
<td>The specified port is not connected to an Aardvark device or the port is already in use.</td>
</tr>
<tr>
<td>AA_INCOMPATIBLE_DEVICE</td>
<td>There is a version mismatch between the DLL and the firmware. The DLL is not of a sufficient version for interoperability with the firmware version or vice versa. See aa_open_ext() for more information.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>This function is recommended for use in simple applications where extended information is not required. For more complex applications, the use of <tt>aa_open_ext()</tt> is recommended.</p>
<p>The open function also deactivates all slave functionality. An Aardvark device could have potentially been opened, enabled as a slave, and configured to send asynchronous responses to a third-party master. If the controlling application quits without calling <tt>aa_close()</tt>, the port is freed but the slave functions can still be active. The open function deactivates slave functionality to ensure that the new application has access to an Aardvark device that is in a known-state. Also the <span style="white-space: nowrap;">I<sup>2</sup>C</span> bus is freed, in the event that it was held indefinitely from a previous <tt>AA_I2C_NO_STOP</tt> transaction.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.4">Open an Aardvark device (aa_open_ext)</h4>
<pre class="api-func">      Aardvark aa_open_ext (int port_number, AardvarkExt *aa_ext);
    </pre>
<p class="api-desc">Open the Aardvark port, returning extended information in the supplied structure.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>port_number</td>
<td>same as <tt>aa_open</tt></td>
</tr>
<tr>
<td>aa_ext</td>
<td>pointer to pre-allocated structure for extended version information available on open</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>This function returns an Aardvark handle, which is guaranteed to be greater than zero if valid.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>AA_UNABLE_TO_OPEN</td>
<td>The specified port is not connected to an Aardvark device or the port is already in use.</td>
</tr>
<tr>
<td>AA_INCOMPATIBLE_DEVICE</td>
<td>There is a version mismatch between the DLL and the firmware. The DLL is not of a sufficient version for interoperability with the firmware version or vice versa. The version information will be available in the memory pointed to by <tt>aa_ext</tt>.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>If 0 is passed as the pointer to the structure, this function will behave exactly like <tt>aa_open()</tt>.</p>
<p>The <tt>AardvarkExt</tt> structure is described below:</p>
<pre>  struct AardvarkExt {
    AardvarkVersion  version;
    /* Features of this device. */
    int              features;
  }
          </pre>
<p>The features field denotes the capabilities of the Aardvark device. See the API function <tt>aa_features</tt> for more information.</p>
<p>The <tt>AardvarkVersion</tt> structure describes the various version dependencies of Aardvark components. It can be used to determine which component caused an incompatibility error.</p>
<pre>  struct AardvarkVersion {
    /* Software, firmware, and
    hardware versions. */
    aa_u16 software;
    aa_u16 firmware;
    aa_u16 hardware;
    /* FW requires that SW must be &gt;= this version. */
    aa_u16 sw_req_by_fw;
    /* SW requires that FW must be &gt;= this version. */
    aa_u16 fw_req_by_sw;
    /* API requires that SW must be &gt;= this version. */
    aa_u16 api_req_by_sw;
  };
          </pre>
<p>All version numbers are of the format:</p>
<blockquote><tt>(major &lt;&lt; 8) | minor</tt> <br /> example: <tt>v1.20</tt> would be encoded as <tt>0x0114</tt>.</blockquote>
<p>The structure is zeroed before the open is attempted. It is filled with whatever information is available. For example, if the firmware version is not filled, then the device could not be queried for its version number.</p>
<p>This function is recommended for use in complex applications where extended information is required. For simpler applications, the use of <tt>aa_open()</tt> is recommended.</p>
<p>This open function also terminates all slave functionality as described for the <tt>aa_open()</tt> call.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.5">Close an Aardvark (aa_close)</h4>
<pre class="api-func">      int aa_close (Aardvark aardvark);
    </pre>
<p class="api-desc">Close the Aardvark port.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter to be closed</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>The number of adapters closed is returned on success. This will usually be 1.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>An Aardvark adapter could have potentially been opened, enabled as a slave, and configured to send and receive asynchronous responses to and from a third-party master. A call to <tt>aa_close()</tt> will deactivate all slave functionality. Also the <span style="white-space: nowrap;">I<sup>2</sup>C</span> bus is freed, in the event that it was held indefinitely from a previous <tt>AA_I2C_NO_STOP</tt> transaction.</p>
<p>If the <tt>handle</tt> argument is zero, the function will attempt to close all possible handles, thereby closing all open Aardvark adapters. The total number of Aardvark adapters closed is returned by the function.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.6">Get Port (aa_port)</h4>
<pre class="api-func">      int aa_port (Aardvark aardvark);
    </pre>
<p class="api-desc">Return the port number for this Aardvark handle.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>The port number corresponding to the given handle is returned. It is a zero-based number.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>None.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.7">Get Features (aa_features)</h4>
<pre class="api-func">      int aa_features (Aardvark aardvark);
    </pre>
<p class="api-desc">Return the device features as a bit-mask of values, or an error code if the handle is not valid.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>The features of the Aardvark device are returned. These are a bit-mask of the following values.</p>
<pre>    #define AA_FEATURE_SPI     (1&lt;&lt;0)
    #define AA_FEATURE_I2C     (1&lt;&lt;1)
    #define AA_FEATURE_GPIO    (1&lt;&lt;3)
        </pre>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>None.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.8">Get Unique ID (aa_unique_id)</h4>
<pre class="api-func">      aa_u32 aa_unique_id (Aardvark aardvark);
    </pre>
<p class="api-desc">Return the unique ID of the given Aardvark device.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>This function returns the unique ID for this Aardvark adapter. The IDs are guaranteed to be non-zero if valid. The ID is the unsigned integer representation of the 10-digit serial number.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>None.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.9">Status String (aa_status_string)</h4>
<pre>      const char *aa_status_string (int status);
    </pre>
<p class="api-desc">Return the status string for the given status code.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>status</td>
<td>status code returned by an Aardvark API function</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>This function returns a human readable string that corresponds to status. If the code is not valid, it returns a NULL string.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>None.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.10">Logging (aa_log)</h4>
<pre class="api-func">      int aa_log (Aardvark aardvark, int level, int handle);
    </pre>
<p class="api-desc">Enable logging to a file.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>level</td>
<td>the logging detail level as described below</td>
</tr>
<tr>
<td>handle</td>
<td>a file descriptor</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>An Aardvark status code is returned with <tt>AA_OK</tt> on success.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>The handle must be standard file descriptor. In C, a file descriptor can be obtained by using the ANSI C function "open" or by using the function "fileno" on a <tt>FILE*</tt> stream. A <tt>FILE*</tt> stream obtained using <tt>fopen</tt> or can correspond to the common <tt>stdout</tt> or <tt>stderr</tt> available when including <tt>stdlib.h</tt>.</p>
<p>The logging detail level can be one of the following options.</p>
<blockquote>0 none <br /> 1 – error <br /> 2 – warning <br /> 3 – info <br /> 4 – debug</blockquote>
<p>Note that if the handle is invalid, the application can crash during a logging operation.</p>
<p>Due to inconsistencies arising from how Microsoft handles linkage to the C runtime library, logging to a file may not work in Windows. However, logging to <tt>stdout</tt> and <tt>stderr</tt> is still supported. As a convenience, the following two constants are defined and can be passed as the <tt>handle</tt> argument.</p>
<ul>
<li><tt>AA_LOG_STDOUT</tt></li>
<li><tt>AA_LOG_STDERR</tt></li>
</ul>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.11">Version (aa_version)</h4>
<pre class="api-func">      int aa_version (Aardvark aardvark, AardvarkVersion *version);
    </pre>
<p class="api-desc">Return the version matrix for the device attached to the given handle.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>version</td>
<td>pointer to pre-allocated structure</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>An Aardvark status code is returned with <tt>AA_OK</tt> on success.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>If the handle is 0 or invalid, only the software version is set.</p>
<p>See the details of <tt>aa_open_ext</tt> for the definition of <tt>AardvarkVersion</tt>.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.12">Configure (aa_configure)</h4>
<pre>      int aa_configure (Aardvark aardvark, AardvarkConfig config);
    </pre>
<p class="api-desc">Activate/deactivate individual subsystems (<span style="white-space: nowrap;">I<sup>2</sup>C</span>, SPI, GPIO).</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>config</td>
<td>enumerated type specifying configuration. See Table <a href="#table.config">2</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="table.config" class="api-table"><center>
<div><strong>Table 2</strong> : <tt>config</tt> enumerated types</div>
<table cellspacing="0">
<tbody>
<tr>
<td><tt>AA_CONFIG_GPIO_ONLY</tt></td>
<td>Configure all pins as GPIO. Disable both <span style="white-space: nowrap;">I<sup>2</sup>C</span> and SPI.</td>
</tr>
<tr>
<td><tt>AA_CONFIG_SPI_GPIO</tt></td>
<td>Configure <span style="white-space: nowrap;">I<sup>2</sup>C</span> pins as GPIO. Enable SPI.</td>
</tr>
<tr>
<td><tt>AA_CONFIG_GPIO_I2C</tt></td>
<td>Configure SPI pins as GPIO. Enable <span style="white-space: nowrap;">I<sup>2</sup>C</span>.</td>
</tr>
<tr>
<td><tt>AA_CONFIG_SPI_I2C</tt></td>
<td>Disable GPIO. Enable both <span style="white-space: nowrap;">I<sup>2</sup>C</span> and SPI.</td>
</tr>
<tr>
<td><tt>AA_CONFIG_QUERY</tt></td>
<td>Queries existing configuration (does not modify).</td>
</tr>
</tbody>
</table>
</center></div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>The current configuration on the Aardvark adapter will be returned. The configuration will be described by the same values in <tt>AardvarkConfig</tt>.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>AA_CONFIG_ERROR</td>
<td>The <span style="white-space: nowrap;">I<sup>2</sup>C</span> or SPI subsystem is currently active and the new configuration requires the subsystem to be deactivated.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>If either the <span style="white-space: nowrap;">I<sup>2</sup>C</span> or SPI subsystems have been disabled by this API call, all other API functions that interact with <span style="white-space: nowrap;">I<sup>2</sup>C</span> or SPI will return <tt>AA_CONFIG_ERROR</tt>.</p>
<p>If configurations are switched, the subsystem specific parameters will be preserved. For example if the SPI bitrate is set to 500 kHz and the SPI system is disabled and then enabled, the bitrate will remain at 500 kHz. This also holds for other parameters such as the SPI mode, SPI slave response, <span style="white-space: nowrap;">I<sup>2</sup>C</span> bitrate, <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave response, etc.</p>
<p>However, if a subsystem is shut off, it will be restarted in a quiescent mode. That is to say, the <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave function will not be reactivated after re-enabling the <span style="white-space: nowrap;">I<sup>2</sup>C</span> subsystem, even if the <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave function was active before first disabling the <span style="white-space: nowrap;">I<sup>2</sup>C</span> subsystem.</p>
<p><strong>Note:</strong> Whenever the configure command is executed and GPIO lines are enabled, the GPIO lines will be momentarily switched to high-Z before their direction and pullup configurations are executed.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.13">Target Power (aa_target_power)</h4>
<pre>      int aa_target_power (Aardvark aardvark, aa_u08 power_mask);
    </pre>
<p class="api-desc">Activate/deactivate target power pins 4 and 6.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>power_mask</td>
<td>enumerated values specifying power pin state. See Table <a href="#table.power">3</a>.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="table.power"><center>
<div><strong>Table 3</strong> : <tt>power_mask</tt> enumerated types</div>
<table cellspacing="0">
<tbody>
<tr>
<td><tt>AA_TARGET_POWER_NONE</tt></td>
<td>Disable target power pins</td>
</tr>
<tr>
<td><tt>AA_TARGET_POWER_BOTH</tt></td>
<td>Enable target power pins</td>
</tr>
<tr>
<td><tt>AA_TARGET_POWER_QUERY</tt></td>
<td>Queries the target power pin state</td>
</tr>
</tbody>
</table>
</center></div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>The current state of the target power pins on the Aardvark adapter will be returned. The configuration will be described by the same values as in the table above.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>AA_INCOMPATIBLE_DEVICE</td>
<td>The hardware version is not compatible with this feature. Only hardware versions 2.00 or greater support switchable target power pins.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>Both target power pins are controlled together. Independent control is not supported. This function may be executed in any operation mode.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.14">Asynchronous Polling (aa_async_poll)</h4>
<pre>      int aa_async_poll (Aardvark aardvark, int timeout);
    </pre>
<p class="api-desc">Check if there is any asynchronous data pending from the Aardvark adapter.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>timeout</td>
<td>timeout in milliseconds</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>A status code indicating which types of asynchronous messages are available for processing. See Table <a href="#table.status">4</a>.</p>
<div id="table.status"><center>
<div><strong>Table 4</strong> : Status code enumerated types</div>
<table cellspacing="0">
<tbody>
<tr>
<td><tt>AA_ASYNC_NO_DATA</tt></td>
<td>No asynchronous data is available.</td>
</tr>
<tr>
<td><tt>AA_ASYNC_I2C_READ</tt></td>
<td><span style="white-space: nowrap;">I<sup>2</sup>C</span> slave read data is available. Use <tt>aa_i2c_slave_read</tt> to get data.</td>
</tr>
<tr>
<td><tt>AA_ASYNC_I2C_WRITE</tt></td>
<td><span style="white-space: nowrap;">I<sup>2</sup>C</span> slave write stats are available. Use <tt>aa_i2c_slave_write_stats</tt> to get data.</td>
</tr>
<tr>
<td><tt>AA_ASYNC_SPI</tt></td>
<td>SPI slave read data is available. Use <tt>aa_spi_slave_read</tt> to get data.</td>
</tr>
</tbody>
</table>
</center></div>
<p>These codes can be bitwise ORed together if there are multiple types of data available.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>Recall that, like all other Aardvark functions, this function is not thread-safe.</p>
<p>If the timeout value is negative, the function will block indefinitely until data arrives. If the timeout value is 0, the function will perform a non-blocking check for pending asynchronous data.</p>
<p>As described before, the Aardvark software contains asynchronous queues that can be filled during synchronous operations on the Aardvark adapter. If data is already in one or more asynchronous queues, it will immediately return with all of the types of asynchronous data that are currently available. Further data may be pending in the operating systems incoming receive buffer, but the function will not examine that data. Hence any pending data in the operating systems incoming buffer will not be reported to the user until the Aardvarks software queues have been fully serviced.</p>
<p>If there is no data already available, this function will check the operating systems receive buffer for the presence of asynchronous data. The function will block for the specified timeout. It will then only report the type of the very first data that has been received. The function will not examine the remainder of the operating systems receive buffer to see what other asynchronous messages are pending.</p>
<p>One can employ the following technique to guarantee that all pending asynchronous data have been captured during each service cycle:</p>
<ol>
<li>Call the polling function with a specified timeout.</li>
<li>If the polling function indicates that there is data available, call the appropriate service function once for each type of data that is available.</li>
<li>Next, call the polling function with a 0 timeout.</li>
<li>Call the appropriate service function once for each type of data that is available.</li>
<li>Repeat steps 3 and 4 until the polling function reports that there is no data available.</li>
</ol>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.4.1.15">Sleep (aa_sleep_ms)</h4>
<pre class="api-func">      u32 aa_sleep_ms (u32 milliseconds);
    </pre>
<p class="api-desc">Sleep for given amount of time.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>milliseconds</td>
<td>number of milliseconds to sleep</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>This function returns the number of milliseconds slept.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>This function provides a convenient cross-platform function to sleep the current thread using standard operating system functions.</p>
<p>The accuracy of this function depends on the operating system scheduler. This function will return the number of milliseconds that were actually slept.</p>
</div>
</div>
<p> </p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s5.5">5.5 <span style="white-space: nowrap;">I<sup>2</sup>C</span> Interface</h2>
<h3 id="s5.5.1">5.5.1 <span style="white-space: nowrap;">I<sup>2</sup>C</span> Notes</h3>
<ol>
<li>It is not necessary to set the bitrate for the Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave.</li>
<li>An <span style="white-space: nowrap;">I<sup>2</sup>C</span> master operation read or write operation can be transacted while leaving the <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave functionality enabled. In a multi-master situation it is possible for the Aardvark adapter to lose the bus during the slave addressing portion of the transaction. If the other master that wins the bus subsequently addresses this Aardvark adapters slave address, the Aardvark adapter will respond appropriately to the request using its slave mode capabilities.</li>
<li>It is always advisable to set the slave response before first enabling the slave. This ensures that valid data is sent to any requesting master.</li>
<li>It is not possible to receive messages larger than approximately 4 KiB as a slave due to operating system limitations on the asynchronous incoming buffer. As such, one should not queue up more than 4 KiB of total slave data between calls to the Aardvark API.</li>
<li>Since firmware revision 2.00 it is possible for the Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> master to employ some of the advanced features of <span style="white-space: nowrap;">I<sup>2</sup>C</span>. This is accomplished by the <tt>AardvarkI2cFlags</tt> argument type that is included in the <tt>aa_i2c_read</tt> and <tt>aa_i2c_write</tt> argument lists. The options in Table <a href="#table.iic-01">5</a> are available can be logically ORed together to combine them for one operation.<br /><br />
<div id="table.iic-01"><center>
<div>
<div><strong>Table 5</strong> : <span style="white-space: nowrap;">I<sup>2</sup>C</span> Advanced Feature Options</div>
<table cellspacing="0">
<tbody>
<tr>
<td><tt>AA_I2C_NO_FLAGS</tt></td>
<td>Request no options.</td>
</tr>
<tr>
<td><tt>AA_I2C_10_BIT_ADDR</tt></td>
<td>Request that the provided address is treated as a 10-bit address. The Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> subsystem will follow the Philips <span style="white-space: nowrap;">I<sup>2</sup>C</span> specification when transmitting the address.</td>
</tr>
<tr>
<td><tt>AA_I2C_COMBINED_FMT</tt></td>
<td>Request that the Philips combined format is followed during a <span style="white-space: nowrap;">I<sup>2</sup>C</span> read operation. Please see the Philips specification for more details. This flag does not have any effect unless a master read operation is requested and the <tt>AA_I2C_10_BIT_ADDR</tt> is also set.</td>
</tr>
<tr>
<td><tt>AA_I2C_NO_STOP</tt></td>
<td>Request that no stop condition is issued on the <span style="white-space: nowrap;">I<sup>2</sup>C</span> bus after the transaction completes. It is expected that the PC will follow up with a subsequent transaction at which point a repeated start will be issued on the bus. Eventually an <span style="white-space: nowrap;">I<sup>2</sup>C</span> transaction must be issued without the "no stop" option so that a stop condition is issued and the bus is freed.</td>
</tr>
<tr>
<td><tt>AA_I2C_SIZED_READ</tt></td>
<td>See <tt>aa_i2c_read</tt> below.</td>
</tr>
<tr>
<td><tt>AA_I2C_SIZED_READ_EXTRA1</tt></td>
<td>See <tt>aa_i2c_read</tt> below.</td>
</tr>
</tbody>
</table>
</div>
</center></div>
</li>
<li>Since firmware revision 3.00 it is possible for the Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> master to return an extended status code for master read and master write transactions. These codes are described in Table <a href="#table.iic-02">6</a> and are returned by the <tt>aa_i2c_read_ext</tt> and <tt>aa_i2c_write_ext</tt> functions, as well as the analogous slave API functions.<br /><br />
<div id="table.iic-02"><center>
<div>
<div><strong>Table 6</strong> : <span style="white-space: nowrap;">I<sup>2</sup>C</span> Extended Status Code</div>
<table cellspacing="0">
<tbody>
<tr>
<td><tt>AA_I2C_STATUS_BUS_ERROR</tt></td>
<td>A bus error has occurred. Transaction was aborted.</td>
</tr>
<tr>
<td><tt>AA_I2C_STATUS_SLA_ACK</tt></td>
<td>Bus arbitration was lost during master transaction; another master on the bus has successfully addressed this Aardvark adapters slave address. As a result, this Aardvark adapter has automatically switched to slave mode and is responding.</td>
</tr>
<tr>
<td><tt>AA_I2C_STATUS_SLA_NACK</tt></td>
<td>The Aardvark adapter failed to receive acknowledgment for the requested slave address during a master operation.</td>
</tr>
<tr>
<td><tt>AA_I2C_STATUS_DATA_NACK</tt></td>
<td>The last data byte in the transaction was not acknowledged by the slave.</td>
</tr>
<tr>
<td><tt>AA_I2C_STATUS_ARB_LOST</tt></td>
<td>Another master device on the bus was accessing the bus simultaneously with this Aardvark adapter. That device won arbitration of the bus as per the <span style="white-space: nowrap;">I<sup>2</sup>C</span>specification.</td>
</tr>
<tr>
<td><tt>AA_I2C_STATUS_BUS_LOCKED</tt></td>
<td>An <span style="white-space: nowrap;">I<sup>2</sup>C</span> packet is in progress, and the time since the last <span style="white-space: nowrap;">I<sup>2</sup>C</span> event executed or received on the bus has exceeded the bus lock timeout. This is most likely due to the clock line of the bus being held low by some other device, or due to the data line held low such that a start condition cannot be executed by the Aardvark. The bus lock timeout can be configured using the <tt>aa_i2c_bus_timeout</tt> function. The Aardvark adapter resets its own <span style="white-space: nowrap;">I<sup>2</sup>C</span> interface when a timeout is observed and no further action is taken on the bus.</td>
</tr>
<tr>
<td><tt>AA_I2C_STATUS_LAST_DATA_ACK</tt></td>
<td>When the Aardvark slave is configured with a fixed length transmit buffer, it will detach itself from the <span style="white-space: nowrap;">I<sup>2</sup>C</span> bus after the buffer is fully transmitted. The Aardvark slave also expects that the last byte sent from this buffer is NACKed by the opposing master device. This status code is returned by the Aardvark slave (see Slave Write Statistics API) if the master device instead ACKs the last byte. The notification can be useful when debugging a third-party master device.</td>
</tr>
</tbody>
</table>
</div>
</center></div>
<p>These codes can provide hints as to why an impartial transaction was executed by the Aardvark adapter. In the event that a bus error occurs while the Aardvark adapter is idle and enabled as a slave (but not currently receiving a message), the adapter will return the bus error through the <tt>aa_i2c_slave_read</tt> function. The length of the message will be 0 bytes but the status code will reflect the bus error.</p>
</li>
</ol>
<p> </p>
<h3 id="s5.5.2">5.5.2 General <span style="white-space: nowrap;">I<sup>2</sup>C</span></h3>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.2.1"><span style="white-space: nowrap;">I<sup>2</sup>C</span> Pullup (aa_i2c_pullup)</h4>
<pre class="api-func">      int aa_i2c_pullup (Aardvark aardvark, aa_u08 pullup_mask);
    </pre>
<p class="api-desc">Activate/deactivate <span style="white-space: nowrap;">I<sup>2</sup>C</span> pull-up resistors on SCL and SDA.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>pullup_mask</td>
<td>enumerated values specifying pullup state. See Table <a href="#table.iic-03">7</a>.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="table.iic-03"><center>
<div><strong>Table 7</strong> : <tt>pullup_mask</tt> enumerated types</div>
<table cellspacing="0">
<tbody>
<tr>
<td><tt>AA_I2C_PULLUP_NONE</tt></td>
<td>Disable SCL/SDA pull-up resistors</td>
</tr>
<tr>
<td><tt>AA_I2C_PULLUP_BOTH</tt></td>
<td>Enable SCL/SDA pull-up resistors</td>
</tr>
<tr>
<td><tt>AA_I2C_PULLUP_QUERY</tt></td>
<td>Queries the pull-up resistor state</td>
</tr>
</tbody>
</table>
</center></div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>The current state of the <span style="white-space: nowrap;">I<sup>2</sup>C</span> pull-up resistors on the Aardvark adapter will be returned. The configuration will be described by the same values as in the table above.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>AA_INCOMPATIBLE_DEVICE</td>
<td>The hardware version is not compatible with this feature. Only hardware versions 2.00 or greater support switchable pull-up resistors pins.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>Both pull-up resistors are controlled together. Independent control is not supported. This function may be performed in any operation mode.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.2.2">Free bus (aa_i2c_free_bus)</h4>
<pre class="api-func">      int aa_i2c_free_bus (Aardvark aardvark);
    </pre>
<p class="api-desc">Free the Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> subsystem from a held bus condition (e.g., "no stop").</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>An Aardvark status code is returned that is <tt>AA_OK</tt> on success.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>AA_I2C_ALREADY_FREE_BUS</td>
<td>The bus was already free and no action was taken.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>If the Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> subsystem had executed a master transaction and is holding the bus due to a previous <tt>AA_I2C_NO_STOP</tt> flag, this function will issue the stop command and free the bus. If the bus is already free, it will return the status code <tt>AA_I2C_BUS_ALREADY_FREE</tt>.</p>
<p>Similarly, if the Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> subsystem was placed into slave mode and in the middle of a slave transaction, this command will disconnect the slave from the bus, flush the last transfer, and re-enable the slave. Such a feature is useful if the Aardvark adapter was receiving bytes but then was forced to wait indefinitely on the bus because of the absence of the terminating stop command. After disabling the slave, any pending slave reception will be available to the host through the usual <tt>aa_i2c_slave_write_stats</tt> and <tt>aa_i2c_slave_read</tt> API calls.</p>
<p>The bus is always freed (i.e., a stop command is executed if necessary) and the slave functions are disabled at software opening and closing of the device.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.2.3">Set Bus Lock Timeout (aa_i2c_bus_timeout)</h4>
<pre class="api-func">      int aa_i2c_bus_timeout (Aardvark aardvark, aa_u16 timeout_ms);
    </pre>
<p class="api-desc">Set the <span style="white-space: nowrap;">I<sup>2</sup>C</span> bus lock timeout in milliseconds.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>timeout_ms</td>
<td>the requested bus lock timeout in ms.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>This function returns the actual timeout set.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>The power-on default timeout is 200ms. The minimum timeout value is 10ms and the maximum is 450ms. If a timeout value outside this range is passed to the API function, the timeout will be restricted. The exact timeout that is set can vary based on the resolution of the timer within the Aardvark adapter. The nominal timeout that was set is returned back by the API function.</p>
<p>If <tt>timeout_ms</tt> is 0, the function will return the bus lock timeout presently set on the Aardvark adapter and the bus lock timeout will be left unmodified.</p>
<p>If the bus is locked during the middle of any <span style="white-space: nowrap;">I<sup>2</sup>C</span> transaction (master transmit, master receive, slave transmit, slave receive) the appropriate extended API function will return the status code <tt>AA_I2C_STATUS_BUS_LOCKED</tt> as described in the preceding Notes section. The bus lock timeout is measured between events on the <span style="white-space: nowrap;">I<sup>2</sup>C</span> bus, where an event is a start condition, the completion of 9bits of data transfer, a repeated start condition, or a stop condition. For example, if a full 9 bits are not completed within the bus lock timeout (due to clock stretching or some other error), the bus lock error will be triggered.</p>
<p>Please note that once the Aardvark adapter detects a bus lock timeout, it will abort its <span style="white-space: nowrap;">I<sup>2</sup>C</span> interface, even if the timeout condition is seen in the middle of a byte. When the Aardvark is acting as an <span style="white-space: nowrap;">I<sup>2</sup>C</span> mater device, this may result in only a partial byte being executed on the bus.</p>
</div>
</div>
<h3 id="s5.5.3">5.5.3 <span style="white-space: nowrap;">I<sup>2</sup>C</span> Master</h3>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.3.1">Set Bitrate (aa_i2c_bitrate)</h4>
<pre class="api-func">      int aa_i2c_bitrate (Aardvark aardvark, int bitrate_khz);
    </pre>
<p class="api-desc">Set the <span style="white-space: nowrap;">I<sup>2</sup>C</span> bitrate in kilohertz.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>bitrate_khz</td>
<td>the requested bitrate in khz.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>This function returns the actual bitrate set.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>The power-on default bitrate is 100 kHz.</p>
<p>Only certain discrete bitrates are supported by the Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> master interface. As such, this actual bitrate set will be less than or equal to the requested bitrate.</p>
<p>If <tt>bitrate_khz</tt> is 0, the function will return the bitrate presently set on the Aardvark adapter and the bitrate will be left unmodified.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.3.2">Master Read (aa_i2c_read)</h4>
<pre class="api-func">      int aa_i2c_read (Aardvark            aardvark,
                       aa_u16              slave_addr,
                       AardvarkI2cFlags    flags,
                       aa_u16              num_bytes,
                       aa_u08 *            data_in);
    </pre>
<p class="api-desc">Read a stream of bytes from the <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave device.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>slave_addr</td>
<td>the slave from which to read</td>
</tr>
<tr>
<td>flags</td>
<td>special operations as described in "Notes" section and below</td>
</tr>
<tr>
<td>num_bytes</td>
<td>the number of bytes to read (maximum 65535)</td>
</tr>
<tr>
<td>data_in</td>
<td>pointer to data</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>Number of bytes read.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>AA_I2C_READ_ERROR</td>
<td>There was an error reading from the Aardvark adapter. This is most likely a result of a communication error.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>For ordinary 7-bit addressing, the lower 7 bits of <tt>slave_addr</tt> should correspond to the slave address. The topmost bits are ignored. The Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> subsystem will assemble the address along with the <tt>R/W</tt> bit after grabbing the bus. For 10-bit addressing, the lower 10 bits of <tt>addr</tt> should correspond to the slave address. The Aardvark adapter will then assemble the address into the proper format as described in the Philips specification, namely by first issuing an write transaction on the bus to specify the 10-bit slave and then a read transaction to read the requested number of bytes. The initial write transaction can be skipped if the "Combined Format" feature is requested in conjunction with the 10-bit addressing functionality.</p>
<p>The <tt>data</tt> pointer should be allocated at least as large as <tt>num_bytes</tt>.</p>
<p>It is possible to read zero bytes from the slave. In this case, <tt>num_bytes</tt> is set to <tt>0</tt> and the <tt>data</tt> argument is ignored (i.e., it can be 0 or point to invalid memory). However, due to the nature of the <span style="white-space: nowrap;">I<sup>2</sup>C</span> protocol, it is not possible to address the slave and not request at least one byte. Therefore, one byte is actually received by the host, but is subsequently thrown away.</p>
<p>If the number of bytes read is zero, the following conditions are possible.</p>
<ul>
<li>The requested slave was not found.</li>
<li>The requested slave is on the bus but refuses to acknowledge its address.</li>
<li>The Aardvark adapter was unable to seize the bus due to the presence of another <span style="white-space: nowrap;">I<sup>2</sup>C</span> master. <strong>Here, the arbitration was lost during the slave addressing phase – results can be unpredictable</strong>.</li>
<li>Zero bytes were requested from a slave. The slave acknowledged its address and returned 1 byte. That byte was dropped.</li>
</ul>
<p>Ordinarily the number of bytes read, if not <tt>0</tt>, will equal the requested number of bytes. One special scenario in which this will not happen is if the Aardvark adapter loses the bus during the data transmission due to the presence of another <span style="white-space: nowrap;">I<sup>2</sup>C</span> master.</p>
<p>If the slave has fewer bytes to transmit than the number requested by the master, the slave will simply stop transmitting and the master will receive <tt>0xff</tt> for each remaining byte in the transmission. This behavior is in accordance with the <span style="white-space: nowrap;">I<sup>2</sup>C</span> protocol.</p>
<p>Additionally, the <tt>flags</tt> argument can be used to specify a sized read operation. If the flag includes the value <tt>AA_I2C_SIZED_READ</tt>, the Aardvark adapter will treat the first byte received from the slave as a packet length field. This length denotes the number of bytes that the slave has available for reading (not including the length byte itself). The Aardvark adapter will continue to read the minimum of <tt>num_bytes-1</tt> and the length field. The length value must be greater than <tt>0</tt>. If it is equal to <tt>0</tt>, it will be treated as though it is <tt>1</tt>. In order to support protocols that include an optional checksum byte (e.g., SMBus) the flag can alternatively be set to <tt>AA_I2C_SIZED_READ_EXTRA1</tt>. In this case the Aardvark will read one more data byte beyond the number specified by the length field.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.3.3">Master Read Extended (aa_i2c_read_ext)</h4>
<pre class="api-func">      int aa_i2c_read_ext (Aardvark            aardvark,
                           aa_u16              slave_addr,
                           AardvarkI2cFlags    flags,
                           aa_u16              num_bytes,
                           aa_u08 *            data_in,
                           aa_u16 *            num_read);
    </pre>
<p class="api-desc">Read a stream of bytes from the <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave device with extended status information.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>slave_addr</td>
<td>the slave from which to read</td>
</tr>
<tr>
<td>flags</td>
<td>special operations as described previously</td>
</tr>
<tr>
<td>num_bytes</td>
<td>the number of bytes to read (maximum 65535)</td>
</tr>
<tr>
<td>data_in</td>
<td>pointer to data</td>
</tr>
<tr>
<td>num_read</td>
<td>the actual number of bytes read</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>Status code (see "Notes" section).</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>This function operates exactly like <tt>aa_i2c_read</tt>, except that the return value now specifies a status code. The number of bytes read is returned through an additional pointer argument at the tail of the parameter list.</p>
<p>The status code allows the user to discover specific events on the <span style="white-space: nowrap;">I<sup>2</sup>C</span> bus that would otherwise be transparent given only the number of bytes transacted. The "Notes" section describes the status codes.</p>
<p>For a master read operation, the <tt>AA_I2C_STATUS_DATA_NACK</tt> flag is not used since the acknowledgment of data bytes is predetermined by the master and the <span style="white-space: nowrap;">I<sup>2</sup>C</span> specification.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.3.4">Master Write (aa_i2c_write)</h4>
<pre class="api-func">      int aa_i2c_write (Aardvark         aardvark,
                        aa_u16           slave_addr,
                        AardvarkI2cFlags flags,
                        aa_u16           num_bytes,
                        const aa_u08 *   data_out);
    </pre>
<p class="api-desc">Write a stream of bytes to the <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave device.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>slave_addr</td>
<td>the slave from which to read</td>
</tr>
<tr>
<td>flags</td>
<td>special operations as described in "Notes" section</td>
</tr>
<tr>
<td>num_bytes</td>
<td>the number of bytes to write (maximum 65535)</td>
</tr>
<tr>
<td>data_out</td>
<td>pointer to data</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>Number of bytes written.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>AA_I2C_WRITE_ERROR</td>
<td>There was an error reading the acknowledgment from the Aardvark adapter. This is most likely a result of a communication error.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>For ordinary 7-bit addressing, the lower 7 bits of <tt>slave_addr</tt> should correspond to the slave address. The topmost bits are ignored. The Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> subsystem will assemble the address along with the <tt>R/W</tt> bit after grabbing the bus. For 10-bit addressing, the lower 10 bits of <tt>addr</tt> should correspond to the slave address. The Aardvark adapter will then assemble the address into the proper format as described in the Philips specification. There is a limitation that a maximum of only 65534 bytes can be written in a single transaction if the 10-bit addressing mode is used.</p>
<p>The <tt>slave_addr 0x00</tt> has been reserved in the <span style="white-space: nowrap;">I<sup>2</sup>C</span> protocol specification for general call addressing. <span style="white-space: nowrap;">I<sup>2</sup>C</span> slaves that are enabled to respond to a general call will acknowledge this address. The general call is not treated specially in the Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> master. The user of this API can manually assemble the first data byte if the hardware address programming feature with general call is required.</p>
<p>It is actually possible to write <tt>0</tt> bytes to the slave. The slave will be addressed and then the stop condition will be immediately transmitted by the Aardvark adapter. No bytes are sent to the slave, so the <tt>data</tt> argument is ignored (i.e., it can be 0 or point to invalid memory).</p>
<p>If the number of bytes written is zero, the following conditions are possible.</p>
<ul>
<li>The requested slave was not found.</li>
<li>The requested slave is on the bus but refuses to acknowledge its address.</li>
<li>The Aardvark adapter was unable to seize the bus due to the presence of another <span style="white-space: nowrap;">I<sup>2</sup>C</span> master. <strong>Here, the arbitration was lost during the slave addressing phase results can be unpredictable</strong>.</li>
<li>The slave was addressed and no bytes were written to it because <tt>num_bytes</tt> was set to <tt>0</tt>.</li>
</ul>
<p>The number of bytes written can be less than the requested number of bytes in the transaction due to the following possibilities.</p>
<ul>
<li>The Aardvark adapter loses the bus during the data transmission due to the presence of another <span style="white-space: nowrap;">I<sup>2</sup>C</span> master.</li>
<li>The slave refuses the reception of any more bytes.</li>
</ul>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.3.5">Master Write Extended (aa_i2c_write_ext)</h4>
<pre class="api-func">      int aa_i2c_write_ext (Aardvark            aardvark,
                            aa_u16              slave_addr,
                            AardvarkI2cFlags    flags,
                            aa_u16              num_bytes,
                            const aa_u08 *      data_out,
                            aa_u16 *            num_written);
    </pre>
<p class="api-desc">Write a stream of bytes to the <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave device with extended status information.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>slave_addr</td>
<td>the slave from which to read</td>
</tr>
<tr>
<td>flags</td>
<td>special operations as described in "Notes" section</td>
</tr>
<tr>
<td>num_bytes</td>
<td>the number of bytes to write (maximum 65535)</td>
</tr>
<tr>
<td>data_out</td>
<td>pointer to data</td>
</tr>
<tr>
<td>num_written</td>
<td>the actual number of bytes written</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>Status code (see "Notes" section).</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>This function operates exactly like <tt>aa_i2c_write</tt>, except that the return value now specifies a status code. The number of bytes written is returned through an additional pointer argument at the tail of the parameter list.</p>
<p>The status code allows the user to discover specific events on the <span style="white-space: nowrap;">I<sup>2</sup>C</span> bus that would otherwise be transparent given only the number of bytes transacted. The "Notes" section describes the status codes.</p>
<p>For a master write operation, the <tt>AA_I2C_STATUS_DATA_NACK</tt> flag can be useful in the following situation:</p>
<ul>
<li>Normally the <span style="white-space: nowrap;">I<sup>2</sup>C</span> master will write to the slave until the slave issues a NACK or the requested number of bytes have been written.</li>
<li>If the master has wishes to write 10 bytes, the <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave issues either an ACK or NACK on the tenth byte without affecting the total number of bytes transferred. Hence, the <tt>aa_i2c_write</tt> function cannot provide the caller with the information that the 10th byte was ACK'ed or NACK'ed.</li>
<li>On the other hand, if the <tt>aa_i2c_write_ext</tt> is used, the status code will distinguish the two scenarios. This status information could be useful for further communications with that particular slave device.</li>
</ul>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.3.6">Master Write-Read (aa_i2c_write_read)</h4>
<pre class="api-func">      int aa_i2c_write_read (Aardvark           aardvark,
                             aa_u16             slave_addr,
                             AardvarkI2cFlags   flags,
                             aa_u16             out_num_bytes,
                             const aa_u08 *     out_data,
                             aa_u16 *           num_written,
                             aa_u16             in_num_bytes,
                             aa_u08 *           in_data,
                             aa_u16 *           num_read);
    </pre>
<p class="api-desc">Write a stream of bytes to the <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave device followed by a read from the same slave device.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>slave_addr</td>
<td>the slave from which to read</td>
</tr>
<tr>
<td>flags</td>
<td>special operations as described in "Notes" section</td>
</tr>
<tr>
<td>out_num_bytes</td>
<td>the number of bytes to write (maximum 65535)</td>
</tr>
<tr>
<td>out_data</td>
<td>pointer to data to write</td>
</tr>
<tr>
<td>num_written</td>
<td>the actual number of bytes written</td>
</tr>
<tr>
<td>in_num_bytes</td>
<td>the number of bytes to read (maximum 65535)</td>
</tr>
<tr>
<td>in_data</td>
<td>pointer to data for read</td>
</tr>
<tr>
<td>num_read</td>
<td>the actual number of bytes read</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>Combined <span style="white-space: nowrap;">I<sup>2</sup>C</span> status code from the write and read operations.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>This function performs the functions of <tt>aa_i2c_write_ext</tt> and <tt>aa_i2c_read_ext</tt> in one atomic operation, thereby minimizing the latency between consecutive write and read operations due to the USB communication layer.</p>
<p>A combined status code from the write and the read operations is provided as the return value of the function. The return value is constructed as <tt>(read_status &lt;&lt; 8) | (write_status)</tt>. See the "Notes" section, along with the details of <tt>aa_i2c_write_ext</tt> and <tt>aa_i2c_read_ext</tt>, for more discussion about the specific status codes. Note that if the write phase of the operation completes with a non-zero status code, the Aardvark adapter will not physically execute the read phase of the operation.</p>
<p>If either the write or read fails with an error (as opposed to simply a non-zero status code), the return value of the function reflects the appropriate error code, with preference given to write errors.</p>
</div>
</div>
<h3 id="s5.5.4">5.5.4 <span style="white-space: nowrap;">I<sup>2</sup>C</span> Slave</h3>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.4.1">Slave Enable (aa_i2c_slave_enable)</h4>
<pre>      int aa_i2c_slave_enable (Aardvark      aardvark,
                               aa_u08        addr,
                               aa_u16        maxTxBytes,
                               aa_u16        maxRxBytes);
    </pre>
<p class="api-desc">Enable the Aardvark adapter as an <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave device.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>addr</td>
<td>address of this slave</td>
</tr>
<tr>
<td>maxTxBytes</td>
<td>max number of bytes to transmit per transaction</td>
</tr>
<tr>
<td>maxRxBytes</td>
<td>max number of bytes to receive per transaction</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>An Aardvark status code is returned that is <tt>AA_OK</tt> on success.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>The lower 7 bits of <tt>addr</tt> should correspond to the slave address of this Aardvark adapter. If the topmost bit of addr is set, the slave will respond to a general call transmission by an <span style="white-space: nowrap;">I<sup>2</sup>C</span> master. After having been addressed by a general call, the Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave treats the transaction no differently than a single slave communication. There is no support for the hardware address programming feature of the general call that is described in the <span style="white-space: nowrap;">I<sup>2</sup>C</span> protocol specification since that capability is not needed for Aardvark devices.</p>
<p>If <tt>maxTxBytes</tt> is <tt>0</tt>, there is no limit on the number of bytes that this slave will transmit per transaction. If it is non-zero, then the slave will stop transmitting bytes at the specified limit and subsequent bytes received by the master will be <tt>0xff</tt> due to the bus pull-up resistors. The response that is transmitted by the slave is set through the <tt>aa_i2c_slave_set_response</tt> function described below. If the maximum is greater than the response (as set through <tt>aa_i2c_slave_set_response</tt> ) the Aardvark slave will wrap the response string as many times as necessary to send the requested number of bytes.</p>
<p>If <tt>maxRxBytes</tt> is <tt>0</tt>, the slave can receive an unlimited number of bytes from the master. However, if it is non-zero, the slave will send a not-acknowledge bit after the last byte that it accepts. The master should then release the bus. Even if the master does not stop transmitting, the slave will return the received data back to the host PC and then transition to a idle state, waiting to be addressed in a subsequent transaction.</p>
<p>It is never possible to <em>restrict </em> a transmit or receive to 0 bytes. Furthermore, once the slave is addressed by a master read operation it is always guaranteed to transmit at least 1 byte.</p>
<p>If a master transaction is executed after the slave features have been enabled, the slave features will remain enabled after the master transaction completes.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.4.2">Slave Disable (aa_i2c_slave_disable)</h4>
<pre class="api-func">      int aa_i2c_slave_disable (Aardvark aardvark);
    </pre>
<p class="api-desc">Disable the Aardvark adapter as an <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave device.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>An Aardvark status code is returned that is <tt>AA_OK</tt> on success.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>None.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.4.3">Slave Set Response (aa_i2c_slave_set_response)</h4>
<pre class="api-func">      int aa_i2c_slave_set_response (Aardvark         aardvark,
                                     aa_u08           num_bytes,
                                     const aa_u08 *   data_out);
    </pre>
<p class="api-desc">Set the slave response in the event the Aardvark adapter is put into slave mode and contacted by a master.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>num_bytes</td>
<td>number of bytes for the slave response</td>
</tr>
<tr>
<td>data_out</td>
<td>pointer to the slave response</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>The number of bytes accepted by the Aardvark slave for the response.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>The value of <tt>num_bytes</tt> must be greater than zero. If it is zero, the response string is undefined until this function is called with the correct parameters.</p>
<p>Due to limited buffer space on the Aardvark slave, the device may only accept a portion of the intended response. If the value returned by this function is less than <tt>num_bytes</tt> the Aardvark slave has dropped the remainder of the bytes.</p>
<p>If more bytes are requested in a transaction, the response string will be wrapped as many times as necessary to complete the transaction.</p>
<p>The buffer space is 64 bytes.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.4.4">Slave Write Statistics (aa_i2c_slave_write_stats)</h4>
<pre class="api-func">      int aa_i2c_slave_write_stats (Aardvark aardvark);
    </pre>
<p class="api-desc">Return number of bytes written from a previous Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave to <span style="white-space: nowrap;">I<sup>2</sup>C</span> master transmission.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>The number of bytes written asynchronously.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>AA_I2C_SLAVE_TIMEOUT</td>
<td>There was no recent slave transmission.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>The transmission of bytes from the Aardvark slave, when it is configured as an <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave, is asynchronous with respect to the PC host software. Hence, there could be multiple responses queued up from previous write transactions.</p>
<p>This function will wait 500 milliseconds before timing out. See the <tt>aa_async_poll</tt> function if a variable timeout is required.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.4.5">Slave Write Statistics Extended (aa_i2c_slave_write_stats_ext)</h4>
<pre class="api-func">      int aa_i2c_slave_write_stats_ext (Aardvark    aardvark,
                                        aa_u16 *    num_written);
    </pre>
<p class="api-desc">Return number of bytes written from a previous Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave to <span style="white-space: nowrap;">I<sup>2</sup>C</span> master transmission with extended status information.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>num_written</td>
<td>: the number of bytes written by the slave</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>Status code (see "Notes" section).</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>This function operates exactly like <tt>aa_i2c_slave_write_stats</tt>, except that the return value now specifies a status code. The number of bytes written is returned through an additional pointer argument at the tail of the parameter list.</p>
<p>The only possible status code is <tt>AA_I2C_STATUS_BUS_ERROR</tt> which can occur when an illegal START, STOP, or RESTART condition appears on the bus during a transaction. In this case the <tt>num_written</tt> may not exactly reflect the number of bytes written by the slave. It can be off by <tt>1</tt>.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.4.6">Slave Read (aa_i2c_slave_read)</h4>
<pre class="api-func">      int aa_i2c_slave_read (Aardvark     aardvark,
                             aa_u08 *     addr,
                             aa_u16       num_bytes,
                             aa_u08 *     data_out);
    </pre>
<p class="api-desc">Read the bytes from an <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave reception.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>addr</td>
<td>the address to which the received message was sent</td>
</tr>
<tr>
<td>num_bytes</td>
<td>the maximum size of the data buffer</td>
</tr>
<tr>
<td>data_out</td>
<td>pointer to data buffer</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>This function returns the number of bytes read asynchronously.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>AA_I2C_SLAVE_TIMEOUT</td>
<td>There was no recent slave transmission.</td>
</tr>
<tr>
<td>AA_I2C_DROPPED_EXCESS_BYTES</td>
<td>The msg was larger than num_bytes.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>If the message was directed to this specific slave, <tt>*addr</tt> will be set to the value of this slaves address. However, this slave may have received this message through a general call addressing. In this case, <tt>*addr</tt> will be <tt>0x80</tt> instead of its own address.</p>
<p>The <tt>num_bytes</tt> parameter specifies the size of the memory pointed to by data. It is possible, however, that the received slave message exceeds this length. In such a situation, <tt>AA_I2C_DROPPED_EXCESS_BYTES</tt> is returned, meaning that <tt>num_bytes</tt> was placed into data but the remaining bytes were discarded.</p>
<p>There is no cause for alarm if the number of bytes read is less than <tt>num_bytes</tt>. This simply indicates that the incoming message was short.</p>
<p>The reception of bytes by the Aardvark slave, when it is configured as an <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave, is asynchronous with respect to the PC host software. Hence, there could be multiple responses queued up from previous transactions.</p>
<p>This function will wait 500 milliseconds before timing out. See the <tt>aa_async_poll</tt> function if a variable timeout is required.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.5.4.7">Slave Read Extended (aa_i2c_slave_read_ext)</h4>
<pre class="api-func">      int aa_i2c_slave_read_ext (Aardvark    aardvark,
                                 aa_u08 *    addr,
                                 aa_u16      num_bytes,
                                 aa_u08 *    data_out
                                 aa_u16 *    num_read);
    </pre>
<p class="api-desc">Read the bytes from an <span style="white-space: nowrap;">I<sup>2</sup>C</span> slave reception with extended status information.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>addr</td>
<td>the address to which the received message was sent</td>
</tr>
<tr>
<td>num_bytes</td>
<td>the maximum size of the data buffer</td>
</tr>
<tr>
<td>data_out</td>
<td>pointer to data buffer</td>
</tr>
<tr>
<td>num_read</td>
<td>the actual number of bytes read by the slave</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>Status code (see "Notes" section).</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>This function operates exactly like <tt>aa_i2c_slave_read</tt>, except that the return value now specifies a status code. The number of bytes read is returned through an additional pointer argument at the tail of the parameter list.</p>
<p>The only possible status code is <tt>AA_I2C_STATUS_BUS_ERROR</tt> which can occur when an illegal START, STOP, or RESTART condition appears on the bus during a transaction.</p>
</div>
</div>
<p> </p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s5.6">5.6 SPI Interface</h2>
<h3 id="s5.6.1">5.6.1 SPI Notes</h3>
<ol>
<li>The SPI master and slave must both be configured to use the same bit protocol (mode).</li>
<li>It is not necessary to set the bitrate for the Aardvark SPI slave.</li>
<li>An SPI master operation read or write operation can be transacted while leaving the SPI slave functionality enabled. During the master transaction, the slave will be temporarily deactivated. Once the master transaction is complete, the slave will be automatically reactivated.</li>
<li>It is always advisable to set the slave response before first enabling the slave. This ensures that valid data is sent to any requesting master.</li>
<li>It is not possible to receive messages larger than approximately 4 KiB as a slave due to operating system limitations on the asynchronous incoming buffer. As such, one should not queue up more than 4 KiB of total slave data between calls to the Aardvark API.</li>
<li>It is not possible to send messages larger than approximately 4 KiB as a master due to operating system limitations on the asynchronous incoming buffer. The SPI is full-duplex so there must be enough buffer space to accommodate the slave response when sending as a master.</li>
<li>Sending zero bytes as an SPI master will simply toggle the slave select line for 5-10 µs.</li>
</ol>
<h3 id="s5.6.2">5.6.2 General SPI</h3>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.6.2.1">Configure (aa_spi_configure)</h4>
<pre class="api-func">      int aa_spi_configure (Aardvark                aardvark,
                            AardvarkSpiPolarity     polarity,
                            AardvarkSpiPhase        phase,
                            AardvarkSpiBitorder     bitorder);
    </pre>
<p class="api-desc">Configure the SPI master or slave interface.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>polarity</td>
<td><tt>AA_SPI_POL_RISING_FALLING</tt> or <tt>AA_SPI_POL_FALLING_RISING</tt></td>
</tr>
<tr>
<td>phase</td>
<td><tt>AA_SPI_PHASE_SAMPLE_SETUP</tt> or <tt>AA_SPI_PHASE_SETUP_SAMPLE</tt></td>
</tr>
<tr>
<td>bitorder</td>
<td><tt>AA_SPI_BITORDER_MSB</tt> or <tt>AA_SPI_BITORDER_LSB</tt></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>An Aardvark status code is returned that is <tt>AA_OK</tt> on success.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>These configuration parameters specify how to clock the bits that are sent and received on the Aardvark SPI interface.</p>
<p>The polarity option specifies which transition constitutes the leading edge and which transition is the falling edge. For example, <tt>AA_SPI_POL_RISING_FALLING</tt> would configure the SPI to idle the SCLK clock line low. The clock would then transition low-to-high on the leading edge and high-to-low on the trailing edge.</p>
<p>The phase option determines whether to sample or setup on the leading edge. For example, <tt>AA_SPI_PHASE_SAMPLE_SETUP</tt> would configure the SPI to sample on the leading edge and setup on the trailing edge.</p>
<p>The bitorder option is used to indicate whether LSB or MSB is shifted first.</p>
<p>The pair ( <tt>AA_SPI_POL_FALLING_RISING</tt>, <tt>AA_SPI_PHASE_SETUP_SAMPLE</tt> ) would correspond to mode 3 in the figure found in the "SPI Background" chapter.</p>
</div>
</div>
<h3 id="s5.6.3">5.6.3 SPI Master</h3>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.6.3.1">Set Bitrate (aa_spi_bitrate)</h4>
<pre class="api-func">      int aa_spi_bitrate (Aardvark aardvark, int bitrate_khz);
    </pre>
<p class="api-desc">Set the SPI bitrate in kilohertz.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>bitrate_khz</td>
<td>the requested bitrate in khz.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>This function returns the actual bitrate set.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>The power-on default bitrate is 1000 kHz.</p>
<p>Only certain discrete bitrates are supported by the Aardvark adapter. As such, this actual bitrate set will be less than or equal to the requested bitrate unless the requested value is less than 125 kHz, in which case the Aardvark adapter will default to 125 kHz.</p>
<p>If <tt>bitrate_khz</tt> is 0, the function will return the bitrate presently set on the Aardvark adapter and the bitrate will be left unmodified.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.6.3.2">Set Slave Select Polarity (aa_spi_master_ss_polarity)</h4>
<pre class="api-func">      int aa_spi_master_ss_polarity (Aardvark                aardvark,
                                     AardvarkSpiSSPolarity   polarity);
    </pre>
<p class="api-desc">Change the output polarity on the SS line.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>polarity</td>
<td>AA_SPI_SS_ACTIVE_LOW or AA_SPI_SS_ACTIVE_HIGH</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>An Aardvark status code is returned that is <tt>AA_OK</tt> on success.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>This function only affects the SPI master functions on the Aardvark adapter. When configured as an SPI slave, the Aardvark adapter will always be setup with SS as active low.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.6.3.3">Master Write/Read (aa_spi_write)</h4>
<pre class="api-func">      int aa_spi_write (Aardvark         aardvark,
                        aa_u16           out_num_bytes,
                        const aa_u08 *   data_out,
                        aa_u16           in_num_bytes,
                        aa_u08 *         data_in);
    </pre>
<p class="api-desc">Write a stream of bytes to the downstream SPI slave device and read back the full-duplex response.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>out_num_bytes</td>
<td>number of bytes to send</td>
</tr>
<tr>
<td>data_out</td>
<td>pointer to the bytes to transmit out</td>
</tr>
<tr>
<td>in_num_bytes</td>
<td>number of bytes to receive</td>
</tr>
<tr>
<td>data_in</td>
<td>pointer to memory that will hold the received data</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>This function returns the total number of bytes read from the slave which normally will be the same as the number of bytes written to the slave. See below for how this value relates to <tt>in_num_bytes</tt>.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>AA_SPI_WRITE_ERROR</td>
<td>There was an error writing to the Aardvark adapter. This is most likely a result of a communication error. Make sure that <tt>out_num_bytes</tt> is less than 4 KiB.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>Due to the full-duplex nature of the SPI protocol, for every byte written to the slave, one byte is also received. The Aardvark will always receive the same number of bytes that it sends out (barring any error). This is the return value mentioned above. The user has the option of saving all, some, or none of those received bytes by varying the size of <tt>in_num_bytes</tt>.</p>
<p>This function will always write out the number of bytes defined by <tt>out_num_bytes</tt> from the memory pointed to by <tt>data_out</tt>. When <tt>out_num_bytes</tt> is larger than <tt>in_num_bytes</tt>, <tt>data_in</tt> is completely filled and any extra bytes are dropped. When <tt>out_num_bytes</tt> is less than <tt>in_num_bytes</tt>, all the received bytes are saved and <tt>data_in</tt> is only partially filled.</p>
<p>The <tt>data_in</tt> pointer should reference memory that is at least allocated to the size specified by <tt>in_num_bytes</tt>. Otherwise there will be a memory access violation in the program.</p>
<p>If <tt>out_num_bytes</tt> is <tt>0</tt>, no bytes will be written to the slave. However, the slave select line will be dropped for 5-10 µs. This can be useful in sending a signal to a downstream SPI slave without actually sending any bytes. For example, if an SPI slave has tied the slave select to an interrupt line and it sees the line is toggled without any bytes sent, it can interpret the action as a command to prepare its firmware for an subsequent reception of bytes. If <tt>out_num_bytes</tt> is <tt>0</tt>, <tt>data_out</tt>, <tt>data_in</tt>, and <tt>in_num_bytes</tt> can be set to <tt>0</tt>.</p>
<p>If the return value of this function is less than <tt>out_num_bytes</tt>, there was an error. SPI is a bit-blasting scheme where the master does not even know if there is a slave on the other end of the transmission. Therefore, it is always expected that the master will send the entire length of the transaction.</p>
<p>An error will likely occur if the number of bytes sent is significantly greater than 4 KiB. This function cannot reliably execute larger transfers due to the buffering issues explained in the "Software | Application Notes" section. Only a partial number of bytes will be sent to the slave and only a partial number will be received from the slave; it is quite possible that these numbers will not be equal. The size of the partial response is returned by this function and any received data up to <tt>in_num_bytes</tt> will be in the memory pointed to by <tt>data_in</tt>. Note that the last few bytes of the response may be corrupted as well.</p>
</div>
</div>
<h3 id="s5.6.4">5.6.4 SPI Slave</h3>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.6.4.1">Slave Enable (aa_spi_slave_enable)</h4>
<pre class="api-func">      int aa_spi_slave_enable (Aardvark aardvark);
    </pre>
<p class="api-desc">Enable the Aardvark as an SPI slave device.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>An Aardvark status code is returned that is <tt>AA_OK</tt> on success.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>None.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.6.4.2">Slave Disable (aa_spi_slave_disable)</h4>
<pre class="api-func">      int aa_spi_slave_disable (Aardvark aardvark);
    </pre>
<p class="api-desc">Disable the Aardvark as an SPI slave device.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>An Aardvark status code is returned that is <tt>AA_OK</tt> on success.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>None.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.6.4.3">Slave Set Response (aa_spi_slave_set_response)</h4>
<pre class="api-func">      int aa_spi_slave_set_response (Aardvark         aardvark,
                                     aa_u08           num_bytes,
                                     const aa_u08 *   data_out);
    </pre>
<p class="api-desc">Set the slave response in the event the Aardvark adapter is put into slave mode and contacted by a master.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>num_bytes</td>
<td>number of bytes for the slave response</td>
</tr>
<tr>
<td>data_out</td>
<td>pointer to the slave response</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>The number of bytes accepted by the Aardvark for the response.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>The value of <tt>num_bytes</tt> must be greater than zero. If it is zero, the response string is undefined until this function is called with the correct parameters.</p>
<p>Due to limited buffer space on the Aardvark slave, the device may only accept a portion of the intended response. If the value returned by this function is less than <tt>num_bytes</tt> the Aardvark slave has dropped the remainder of the bytes.</p>
<p>If more bytes are requested in a transaction, the response string will be wrapped as many times as necessary to complete the transaction.</p>
<p>The buffer space will nominally be 64 bytes but may change depending on firmware revision.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.6.4.4">Slave Read (aa_spi_slave_read)</h4>
<pre class="api-func">      int aa_spi_slave_read (Aardvark     aardvark,
                             aa_u16       num_bytes,
                             aa_u08 *     data_in);
    </pre>
<p class="api-desc">Read the bytes from an SPI slave reception.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>num_bytes</td>
<td>the maximum size of the data buffer</td>
</tr>
<tr>
<td>data_in</td>
<td>pointer to data buffer</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>This function returns the number of bytes read asynchronously.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>AA_SPI_SLAVE_TIMEOUT</td>
<td>There was no recent slave transmission.</td>
</tr>
<tr>
<td>AA_SPI_DROPPED_EXCESS_BYTES</td>
<td>The msg was larger than num_bytes.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>The <tt>num_bytes</tt> parameter specifies the size of the memory pointed to by data. It is possible, however, that the received slave message exceeds this length. In such a situation, <tt>AA_SPI_DROPPED_EXCESS_BYTES</tt> is returned, meaning that num_bytes was placed into data but the remaining bytes were discarded.</p>
<p>There is no cause for alarm if the number of bytes read is less than <tt>num_bytes</tt>. This simply indicates that the incoming message was short.</p>
<p>The reception of bytes by the Aardvark adapter, when it is configured as an SPI slave, is asynchronous with respect to the PC host software. Hence, there could be multiple responses queued up from previous write transactions.</p>
<p>This function will wait 500 milliseconds before timing out. See the <tt>aa_async_poll</tt> function if a variable timeout is required.</p>
<p>The SPI API does not include a function that is analogous to the <span style="white-space: nowrap;">I<sup>2</sup>C</span> function <br /> <tt>aa_i2c_slave_write_stats</tt>. Since SPI is a full-duplex standard, the slave writes to the master whenever it receives bytes from the master. Hence, a received message from <tt>aa_i2c_slave_read</tt> implies that an equal number of bytes were sent to the master.</p>
</div>
</div>
<p> </p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s5.7">5.7 GPIO Interface</h2>
<h3 id="s5.7.1">5.7.1 GPIO Notes</h3>
<ol>
<li>The following enumerated type maps the named lines on the Aardvark <span style="white-space: nowrap;">I<sup>2</sup>C</span>/SPI output cable to bit positions in the GPIO API. All GPIO API functions will index these lines through a single 8-bit masked value. Thus, each bit position in the mask can be referred back its corresponding line through the mapping described below.
<div id="table.gpio.constants"><center>
<div><strong>Table 8</strong> : <tt>AardvarkGpioBits</tt> : enumerated type of line locations in bit mask</div>
<div>
<table cellspacing="0">
<tbody>
<tr>
<td><tt>AA_GPIO_SCL</tt></td>
<td>Pin 1</td>
<td><tt>0x01</tt></td>
<td><span style="white-space: nowrap;">I<sup>2</sup>C</span> SCL line</td>
</tr>
<tr>
<td><tt>AA_GPIO_SDA</tt></td>
<td>Pin 3</td>
<td><tt>0x02</tt></td>
<td><span style="white-space: nowrap;">I<sup>2</sup>C</span> SDA line</td>
</tr>
<tr>
<td><tt>AA_GPIO_MISO</tt></td>
<td>Pin 5</td>
<td><tt>0x04</tt></td>
<td>SPI MISO line</td>
</tr>
<tr>
<td><tt>AA_GPIO_SCK</tt></td>
<td>Pin 7</td>
<td><tt>0x08</tt></td>
<td>SPI SCK line</td>
</tr>
<tr>
<td><tt>AA_GPIO_MOSI</tt></td>
<td>Pin 8</td>
<td><tt>0x10</tt></td>
<td>SPI MOSI line</td>
</tr>
<tr>
<td><tt>AA_GPIO_SS</tt></td>
<td>Pin 9</td>
<td><tt>0x20</tt></td>
<td>SPI SS line</td>
</tr>
</tbody>
</table>
</div>
</center></div>
</li>
<li>There is no check in the GPIO API calls to see if a particular GPIO line is enabled in the current configuration. If a line is not enabled for GPIO, the get function will simply return <tt>0</tt> for those bits. Another example is if one changes the GPIO directions for <span style="white-space: nowrap;">I<sup>2</sup>C</span> lines while the <span style="white-space: nowrap;">I<sup>2</sup>C</span> subsystem is still active. These new direction values will be cached and will automatically be activate if a later call to aa_configure disables the <span style="white-space: nowrap;">I<sup>2</sup>C</span> subsystem and enables GPIO for the <span style="white-space: nowrap;">I<sup>2</sup>C</span> lines. The same type of behavior holds for <tt>aa_gpio_pullup</tt> and <tt>aa_gpio_set</tt>.</li>
<li>Additionally, for lines that are not configured as inputs, a change in the pullup configuration using <tt>aa_gpio_pullup</tt> will be cached and will take effect the next time the line is active and configured as an input. The same behavior holds for <tt>aa_gpio_set</tt> when a line is configured as an input instead of an output.</li>
<li>On Aardvark adapter power-up, directions default to all input, pullups default to disabled and outputs default to logic low. Also the GPIO subsystem is off by default. It must be activated by using <tt>aa_configure</tt>.</li>
<li>Note: For hardware version 1.02, it is not possible to have high-Z inputs on the <span style="white-space: nowrap;">I<sup>2</sup>C</span> lines since that hardware has 2.2K pullups on the <span style="white-space: nowrap;">I<sup>2</sup>C</span> bus.</li>
</ol>
<h3 id="s5.7.2">5.7.2 GPIO Interface</h3>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.7.2.1">Direction (aa_gpio_direction)</h4>
<pre class="api-func">      int aa_gpio_direction (Aardvark     aardvark,
                             aa_u08       direction_mask);
    </pre>
<p class="api-desc">Change the direction of the GPIO lines between input and output directions.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>direction_mask</td>
<td>each bit corresponds to the physical line as given by <tt>AardvarkGpioBits</tt>. If a line's bit is <tt>0</tt>, the line is configured as an input. Otherwise it will be an output.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>An Aardvark status code is returned that is <tt>AA_OK</tt> on success.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>None.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.7.2.2">Pullup (aa_gpio_pullup)</h4>
<pre class="api-func">      int aa_gpio_pullup (Aardvark      aardvark,
                          aa_u08        pullup_mask);
    </pre>
<p class="api-desc">Change the pullup configuration of the GPIO lines.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>pullup_mask</td>
<td>each bit corresponds to the physical line as given by <tt>AardvarkGpioBits</tt>. If a line's bit is <tt>1</tt>, the line's pullup is active whenever the line is configured as an input. Otherwise the pullup will be deactivated.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>An Aardvark status code is returned that is <tt>AA_OK</tt> on success.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>None.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.7.2.3">Get (aa_gpio_get)</h4>
<pre class="api-func">      int aa_gpio_get (Aardvark aardvark);
    </pre>
<p class="api-desc">Get the value of current GPIO inputs.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>An integer value, organized as a bitmask in the fashion described by <tt>AardvarkGpioBits</tt>. Any line that is logic high will have a its corresponding bit active. If the line is logic low the bit will not be active in the bit mask.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>A line's bit position in the mask will be <tt>0</tt> if it is configured as an output or if it corresponds to a subsystem that is still active.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.7.2.4">Set (aa_gpio_set)</h4>
<pre class="api-func">      int aa_gpio_set (Aardvark     aardvark,
                       aa_u08       value);
    </pre>
<p class="api-desc">Set the value of current GPIO outputs.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>value</td>
<td>a bitmask specifying which outputs should be set to logic high and which should be set to logic low.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>An Aardvark status code is returned that is <tt>AA_OK</tt> on success.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>If a line is configured as an input or not activated for GPIO, the output value will be cached. The next time the line is an output and activated for GPIO, the output value previously set will automatically take effect.</p>
</div>
</div>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h4 id="s5.7.2.5">Change (aa_gpio_change)</h4>
<pre class="api-func">      int aa_gpio_change (Aardvark     aardvark,
                          aa_u16       timeout);
    </pre>
<p class="api-desc">Block until there is a change on the GPIO input lines.</p>
<div class="api api-args">
<div class="heading">Arguments</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>aardvark</td>
<td>handle of an Aardvark adapter</td>
</tr>
<tr>
<td>timeout</td>
<td>time to wait for a change in milliseconds</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-return">
<div class="heading">Return Value</div>
<div class="content">
<p>The current state of the GPIO input lines.</p>
</div>
</div>
<div class="api api-errors">
<div class="heading">Specific Error Codes</div>
<div class="content">
<table class="api">
<tbody>
<tr>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="api api-details">
<div class="heading">Details</div>
<div class="content">
<p>The function will return either when a change has occurred or the timeout expires. Pins configured for <span style="white-space: nowrap;">I<sup>2</sup>C</span> or SPI will be ignored. Pins configured as outputs will be ignored. The timeout, specified in milliseconds, has a precision of approximately 2 ms. The maximum allowable timeout is approximately 60 seconds. If the timeout expires, this function will return the current state of the GPIO lines. It is the applications responsibility to save the old value of the lines and determine if there is a change based on the return value of this function.</p>
<p>The function <tt>aa_gpio_change</tt> will return immediately with the current value of the GPIO lines for the first invocation after any of the following functions are called: <tt>aa_configure</tt>, <tt>aa_gpio_direction</tt>, or <tt>aa_gpio_pullup</tt>. If the function <tt>aa_gpio_get</tt> is called before calling <tt>aa_gpio_change</tt>, <tt>aa_gpio_change</tt> will only register any changes from the value last returned by <tt>aa_gpio_get</tt>.</p>
</div>
</div>
<p> </p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s5.8">5.8 Error Codes</h2>
<div id="table.error_codes"><center>
<div><strong>Table 9</strong> : Aardvark API Error Codes</div>
<table cellspacing="0">
<tbody>
<tr>
<td><strong>Literal Name</strong></td>
<td class="right"><strong>Value</strong></td>
<td><strong>aa_status_string() return value</strong></td>
</tr>
<tr>
<td>AA_OK</td>
<td class="right">0</td>
<td>ok</td>
</tr>
<tr>
<td>AA_UNABLE_TO_LOAD_LIBRARY</td>
<td class="right">-1</td>
<td>unable to load library</td>
</tr>
<tr>
<td>AA_UNABLE_TO_LOAD_DRIVER</td>
<td class="right">-2</td>
<td>unable to load USB driver</td>
</tr>
<tr>
<td>AA_UNABLE_TO_LOAD_FUNCTION</td>
<td class="right">-3</td>
<td>unable to load binding function</td>
</tr>
<tr>
<td>AA_INCOMPATIBLE_LIBRARY</td>
<td class="right">-4</td>
<td>incompatible library version</td>
</tr>
<tr>
<td>AA_INCOMPATIBLE_DEVICE</td>
<td class="right">-5</td>
<td>incompatible device version</td>
</tr>
<tr>
<td>AA_COMMUNICATION_ERROR</td>
<td class="right">-6</td>
<td>communication error</td>
</tr>
<tr>
<td>AA_UNABLE_TO_OPEN</td>
<td class="right">-7</td>
<td>unable to open device</td>
</tr>
<tr>
<td>AA_UNABLE_TO_CLOSE</td>
<td class="right">-8</td>
<td>unable to close device</td>
</tr>
<tr>
<td>AA_INVALID_HANDLE</td>
<td class="right">-9</td>
<td>invalid device handle</td>
</tr>
<tr>
<td>AA_CONFIG_ERROR</td>
<td class="right">-10</td>
<td>configuration error</td>
</tr>
<tr>
<td>AA_I2C_NOT_AVAILABLE</td>
<td class="right">-100</td>
<td>i2c feature not available</td>
</tr>
<tr>
<td>AA_I2C_NOT_ENABLED</td>
<td class="right">-101</td>
<td>i2c not enabled</td>
</tr>
<tr>
<td>AA_I2C_READ_ERROR</td>
<td class="right">-102</td>
<td>i2c read error</td>
</tr>
<tr>
<td>AA_I2C_WRITE_ERROR</td>
<td class="right">-103</td>
<td>i2c write error</td>
</tr>
<tr>
<td>AA_I2C_SLAVE_BAD_CONFIG</td>
<td class="right">-104</td>
<td>i2c slave enable bad config</td>
</tr>
<tr>
<td>AA_I2C_SLAVE_READ_ERROR</td>
<td class="right">-105</td>
<td>i2c slave read error</td>
</tr>
<tr>
<td>AA_I2C_SLAVE_TIMEOUT</td>
<td class="right">-106</td>
<td>i2c slave timeout</td>
</tr>
<tr>
<td>AA_I2C_DROPPED_EXCESS_BYTES</td>
<td class="right">-107</td>
<td>i2c slave dropped excess bytes</td>
</tr>
<tr>
<td>AA_I2C_BUS_ALREADY_FREE</td>
<td class="right">-108</td>
<td>i2c bus already free</td>
</tr>
<tr>
<td>AA_SPI_NOT_AVAILBLE</td>
<td class="right">-200</td>
<td>spi feature not available</td>
</tr>
<tr>
<td>AA_SPI_NOT_ENABLED</td>
<td class="right">-201</td>
<td>spi not enabled</td>
</tr>
<tr>
<td>AA_SPI_WRITE_ERROR</td>
<td class="right">-202</td>
<td>spi write error</td>
</tr>
<tr>
<td>AA_SPI_SLAVE_READ_ERROR</td>
<td class="right">-203</td>
<td>spi slave read error</td>
</tr>
<tr>
<td>AA_SPI_SLAVE_TIMEOUT</td>
<td class="right">-204</td>
<td>spi slave timeout</td>
</tr>
<tr>
<td>AA_SPI_DROPPED_EXCESS_BYTES</td>
<td class="right">-205</td>
<td>spi slave dropped excess bytes</td>
</tr>
<tr>
<td>AA_GPIO_NOT_AVAILABLE</td>
<td class="right">-400</td>
<td>gpio feature not available</td>
</tr>
</tbody>
</table>
</center></div>
<p> </p>
<h1 id="s6">6 Legal / Contact</h1>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s6.1">6.1 Disclaimer</h2>
<p>All of the software and documentation provided in this manual, is copyright Total Phase, Inc. ("Total Phase"). License is granted to the user to freely use and distribute the software and documentation in complete and unaltered form, provided that the purpose is to use or evaluate Total Phase products. Distribution rights do not include public posting or mirroring on Internet websites. Only a link to the Total Phase download area can be provided on such public websites.</p>
<p>Total Phase shall in no event be liable to any party for direct, indirect, special, general, incidental, or consequential damages arising from the use of its site, the software or documentation downloaded from its site, or any derivative works thereof, even if Total Phase or distributors have been advised of the possibility of such damage. The software, its documentation, and any derivative works is provided on an "as-is" basis, and thus comes with absolutely no warranty, either express or implied. This disclaimer includes, but is not limited to, implied warranties of merchantability, fitness for any particular purpose, and non-infringement. Total Phase and distributors have no obligation to provide maintenance, support, or updates.</p>
<p>Information in this document is subject to change without notice and should not be construed as a commitment by Total Phase. While the information contained herein is believed to be accurate, Total Phase assumes no responsibility for any errors and/or omissions that may appear in this document.</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s6.2">6.2 Life Support Equipment Policy</h2>
<p>Total Phase products are not authorized for use in life support devices or systems. Life support devices or systems include, but are not limited to, surgical implants, medical systems, and other safety-critical systems in which failure of a Total Phase product could cause personal injury or loss of life. Should a Total Phase product be used in such an unauthorized manner, Buyer agrees to indemnify and hold harmless Total Phase, its officers, employees, affiliates, and distributors from any and all claims arising from such use, even if such claim alleges that Total Phase was negligent in the design or manufacture of its product.</p>
<div class="toplink"><a href="#top"> <img src="/media/docs/top-icon.png" alt="" /> </a> <a href="#top">Top</a></div>
<h2 id="s6.3">6.3 Contact Information</h2>
<p>Total Phase can be found on the Internet at <a href="http://www.totalphase.com/">http://www.totalphase.com/</a>. If you have support-related questions, please go to the Total Phase website. For sales inquiries, please contact <a href="mailto:sales@totalphase.com">sales@totalphase.com</a>.</p>
<center>
<p>©2003-2014 Total Phase, Inc. <br /> All rights reserved.</p>
</center></div>
</div>
<div id="article-attachments" class="article-attachments">
  <ul class="attachments">
    
      <li>
        <a href="/support/article_attachments/200626813/aardvark-v5.15.pdf" target="_blank">aardvark-v5.15.pdf</a>
        <span>(500 KB)</span>
      </li>
    
  </ul>
</div>
<div class="article-more-questions">
<b>  Have more questions? <a href="/support/requests/new">Submit a request</a>
</b>
</div>
<section class="article-body">
<!--  <div data-recent-articles></div>
-->
  
  <section class="related-articles">
    
      <h3 class="related-articles-title">Related articles</h3>
    
    <ul>
      
        <li>
          <a href="/support/related/click?data=BAh7CjobZGVzdGluYXRpb25fYXJ0aWNsZV9pZGkEK6j2CzoYcmVmZXJyZXJfYXJ0aWNsZV9pZGkEXOfyCzoLbG9jYWxlSSIKZW4tdXMGOgZFVDoIdXJsSSJUL2hjL2VuLXVzL2FydGljbGVzLzIwMDcxNDI4My1CZWFnbGUtSTJDLVNQSS1Qcm90b2NvbC1BbmFseXplci1RdWljay1TdGFydC1HdWlkZQY7CFQ6CXJhbmtpBg%3D%3D--a820cc8b92d28bc7baf19775169386b36b1f8a2e" rel="nofollow">Beagle I2C/SPI Protocol Analyzer Quick Start Guide</a>
        </li>
      
        <li>
          <a href="/support/related/click?data=BAh7CjobZGVzdGluYXRpb25fYXJ0aWNsZV9pZGkEmVzcDDoYcmVmZXJyZXJfYXJ0aWNsZV9pZGkEXOfyCzoLbG9jYWxlSSIKZW4tdXMGOgZFVDoIdXJsSSIBjC9oYy9lbi11cy9hcnRpY2xlcy8yMTU3NjgyMTctUHJvZ3JhbW1pbmctSTJDLUVFUFJPTS11c2luZy1BYXJkdmFyay1BZGFwdGVyLWFuZC1Db250cm9sLUNlbnRlci1TZXJpYWwtQmF0Y2gtTW9kZS1vbi1MaW51eC1VYnVudHUtMTQtMDQtNjQtYml0BjsIVDoJcmFua2kH--93bb92b8d7f6c4f7f301f29fa6f77fe974ea8051" rel="nofollow">Programming I2C EEPROM using Aardvark Adapter and Control Center Serial Batch Mode on Linux Ubuntu 14.04 64 bit</a>
        </li>
      
        <li>
          <a href="/support/related/click?data=BAh7CjobZGVzdGluYXRpb25fYXJ0aWNsZV9pZGkE7%2FP0CzoYcmVmZXJyZXJfYXJ0aWNsZV9pZGkEXOfyCzoLbG9jYWxlSSIKZW4tdXMGOgZFVDoIdXJsSSJRL2hjL2VuLXVzL2FydGljbGVzLzIwMDYwMjYwNy1BYXJkdmFyay1JMkMtU1BJLUhvc3QtQWRhcHRlci1RdWljay1TdGFydC1HdWlkZQY7CFQ6CXJhbmtpCA%3D%3D--b5bf6c7b96217ddbd21006c3b0c61cde33f95f90" rel="nofollow">Aardvark I2C/SPI Host Adapter Quick Start Guide</a>
        </li>
      
        <li>
          <a href="/support/related/click?data=BAh7CjobZGVzdGluYXRpb25fYXJ0aWNsZV9pZGkECUD0CzoYcmVmZXJyZXJfYXJ0aWNsZV9pZGkEXOfyCzoLbG9jYWxlSSIKZW4tdXMGOgZFVDoIdXJsSSJDL2hjL2VuLXVzL2FydGljbGVzLzIwMDU1NjU1My1GbGFzaC1DZW50ZXItU29mdHdhcmUtVXNlci1NYW51YWwGOwhUOglyYW5raQk%3D--faedae106f820dd57ea38989b7f3d2980394d9fe" rel="nofollow">Flash Center Software User Manual</a>
        </li>
      
    </ul>
  </section>
</section>
  </main>
  </div>
</div>
</div>
</div>
  <!-- / -->
  
  <script src="//static.zdassets.com/hc/assets/en-us.f9dd74d52e6c8eec0350.js"></script>
  <script src="https://www.totalphase.com/auth/v2/host.js" data-brand-id="1311766" data-return-to="https://www.totalphase.com/support/articles/200468316-Aardvark-I2C-SPI-Host-Adapter-User-Manual" data-theme="hc" data-locale="en-us" data-auth-origin="1311766,false,true"></script>
  <script type="text/javascript">
  /*
    Greetings sourcecode lurker!
    This is for internal Zendesk and legacy usage,
    we don't support or guarantee any of these values
    so please don't build stuff on top of them.
  */
  HelpCenter = {};
  HelpCenter.account = {"subdomain":"totalphase","environment":"production","name":"Total Phase"};
  HelpCenter.user = {"identifier":"da39a3ee5e6b4b0d3255bfef95601890afd80709","email":null,"name":null,"role":"anonymous","avatar_url":"https://assets.zendesk.com/hc/assets/default_avatar.png","is_admin":false,"organizations":[],"groups":[]};
  HelpCenter.internal = {"asset_url":"//static.zdassets.com/hc/assets/","web_widget_asset_composer_url":"https://static.zdassets.com/ekr/snippet.js","current_session":{"locale":"en-us","csrf_token":null,"shared_csrf_token":null},"settings":{"zopim_enabled":true},"usage_tracking":{"event":"article_viewed","data":"BAh7CDoLbG9jYWxlSSIKZW4tdXMGOgZFVDoPYXJ0aWNsZV9pZGkEXOfyCzoKX21ldGF7CzoPYWNjb3VudF9pZGkDAwgGOhNoZWxwX2NlbnRlcl9pZGkEB+DrCzoNYnJhbmRfaWRpAxYEFDoMdXNlcl9pZDA6DnVzZXJfcm9sZUkiDmFub255bW91cwY7BlQ7AEkiCmVuLXVzBjsGVA==--5af5c7d4f05c3410e74e234b6fc3e1d81bf8ca07","url":"https://www.totalphase.com/hc/tracking/events?locale=en-us"},"current_record_id":"200468316","current_record_url":"/support/articles/200468316-Aardvark-I2C-SPI-Host-Adapter-User-Manual","current_record_title":"Aardvark I2C/SPI Host Adapter User Manual","search_results_count":null,"current_text_direction":"ltr","current_brand_url":"https://www.totalphase.com","current_host_mapping":null,"current_path":"/support/articles/200468316-Aardvark-I2C-SPI-Host-Adapter-User-Manual","authentication_domain":"https://www.totalphase.com","show_autocomplete_breadcrumbs":true,"rollbar_config":{"enabled":true,"endpoint":"https://rollbar-us.zendesk.com/api/1/item/","accessToken":"731a5a953e9a4b7ab6cac9623f50c732","captureUncaught":true,"captureUnhandledRejections":true,"payload":{"environment":"production","client":{"javascript":{"source_map_enabled":true,"code_version":"bf4cf40250922d212e22c1e3243d139e0553a37a","guess_uncaught_frames":true}}}},"user_info_changing_enabled":false,"has_user_profiles_enabled":false,"user_aliases_enabled":false,"has_anonymous_kb_voting":false,"has_multi_language_help_center":true,"mobile_device":false,"mobile_site_enabled":false,"show_at_mentions":false,"embeddables_config":{"embeddables_web_widget":false,"embeddables_connect_ipms":false},"base_domain":"zendesk.com","answer_bot_subdomain":"static","plans_url":"https://www.totalphase.com/hc/admin/plan?locale=en-us","manage_content_url":"https://www.totalphase.com/support/","arrange_content_url":"https://www.totalphase.com/hc/admin/arrange_contents?locale=en-us","general_settings_url":"https://www.totalphase.com/hc/admin/general_settings?locale=en-us","user_segments_url":"https://www.totalphase.com/knowledge/user_segments?brand_id=1311766","has_community_enabled":false,"has_user_segments":true,"has_answer_bot_web_form_enabled":false,"billing_url":"/access/return_to?return_to=https://www.totalphase.com/admin/billing/subscription","has_answer_bot":true,"has_block_answer_bot_embeddable":false,"answer_bot_management_url":"/access/return_to?return_to=https://www.totalphase.com/agent/admin/answer_bot","is_account_owner":false,"theming_cookie_key":"hc-da39a3ee5e6b4b0d3255bfef95601890afd807091-preview","is_preview":false,"has_guide_user_segments_search":true,"has_alternate_templates":false,"arrange_articles_url":"https://www.totalphase.com/knowledge/arrange?brand_id=1311766","article_verification_url":"https://www.totalphase.com/knowledge/verification?brand_id=1311766","has_article_verification":false,"guide_language_settings_url":"https://www.totalphase.com/hc/admin/language_settings?locale=en-us","docs_importer_url":"https://www.totalphase.com/knowledge/import_articles?brand_id=1311766","community_settings_url":"https://www.totalphase.com/knowledge/community_settings?brand_id=1311766","gather_plan_state":"subscribed","search_settings_url":"https://www.totalphase.com/knowledge/search_settings?brand_id=1311766","has_multibrand_search_in_plan":false,"theming_api_version":1,"has_merged_stats_endpoints":false,"has_pci_credit_card_custom_field":true,"current_brand_id":1311766,"help_center_restricted":false,"current_brand_active":true,"is_assuming_someone_else":false,"flash_messages":[]};
</script>
  <script src="//static.zdassets.com/hc/assets/moment-f6f8513da6ab17eadada59a1a4edb536.js"></script>
  <script src="//static.zdassets.com/hc/assets/hc_enduser-6ed075b6ec6d0718efe336cfea1c225f.js"></script>
      <div class="footer-wrap">
      <div class="footer-container">
        <div class="footer">
          <div class="footer-block">
            <a href="https://www.totalphase.com/solutions/video/" >
              <span class="title">VIDEO</span>
              <span class="content"> <span class="vidlink"></span> </span>
            </a>

          </div>
          <div class="footer-block">
            <a href="https://www.totalphase.com/debugging/i2c/" >
              <span class="title">Debugging</span>
              <span class="content"> <span class='debugg-icon'></span> </span>
            </a>
          </div>
          <div class="footer-block">
            <a href="https://www.totalphase.com/blog/">
              <span class="title">blog</span>
              <span class="content"> <span class="blog-icon"></span></span>
            </a>
          </div>
          <div class="footer-block">
            <a href="https://www.totalphase.com/company/events/">
              <span class="title">Events/Training</span>
              <span class="content"> <span class="design-west"></span> </span>
            </a>
          </div>
        </div>
      </div>
    </div>
<div id="footer-wrap">
  <footer>
    <div class="right-footer">
      <nav class="footer-nav-right">
        <a href="https://www.totalphase.com/sales/quote/" class="icon-quote" data-tip="How to Receive an Instant Quote" ></a>

        <a href="https://www.totalphase.com/demo-request/" class="icon-demo" data-tip="Request a Demo"></a>

        <a href="https://www.totalphase.com/sales/ordering/" class="icon-buy" data-tip="How to Buy"></a>
      </nav>
    </div>
    <div class="left-footer">
      <div id="counter" class="right" style="margin:5px 98px 0 0;">
        <input type="hidden" name="counter-value" value="0" />
      </div>
      <div class="copyright">Copyright &copy; 2020 Total Phase, Inc. All rights reserved.    </div>
      <nav class="footer-nav"> <p><a href="https://www.totalphase.com/company/">About Us</a>&middot;<a href="https://www.totalphase.com/legal/">Terms of Use</a>&middot;<a href="https://www.totalphase.com/privacy/">Privacy Notice</a>&middot;<a href="https://www.totalphase.com/sitemap/">Site Map</a>&middot;<a href="https://www.totalphase.com/company/careers/">Careers</a></p></nav>
    </div>
  </footer>
</div>
<script id="__maSrc" type="text/javascript" data-pid="5081">// <![CDATA[
(function(c,a,p,j,s)

{ p=c.createElement(a);j=!c.URL.indexOf('https:')?'s':''; p.type='text/java'+a; p.src='http'+j+'://'+j+'c.cdnma.com/apps/5081/capture.js'; s=c.getElementsByTagName(a)[0];s.parentNode.insertBefore(p,s); }
(document,'script'));
// ]]></script>
  </div>
</div>
</body>
<script type="text/javascript" >
$jq(document).ready(function() {
  var text = 'request_custom_fields_';
  $jq('*[id*='+text+']').each(function(i,val) {	 
		if($jq("#"+val.id).attr('data-tagger')) {
			var value = $jq("#"+val.id).attr('data-tagger');
			var json = $jq.parseJSON(value);
			getDropDownList("sel_"+val.id, json,val.id);			
		}
	 });
	$jq( "form#new_request" ).attr( "enctype", "multipart/form-data" );
	$jq( "form.comment-form" ).attr( "enctype", "multipart/form-data" );
	// removing the dropzone class and text
	$jq("div#upload-dropzone").find('span').remove(); 
    $jq("div#upload-dropzone").removeClass();
	
	$jq("input#request-attachments").attr('name', $jq("#request-attachments").data('name'));
	$jq('#request_issue_type_select').on('change', function () {
          var url = $jq("#request_issue_type_select").find("option:selected").data("url"); // get selected value
          if (url) { // require a URL
              window.location = url;
          }
          return false;
   });

	
});
 $jq(document).on('change','#request-status-select, #request-organization-select, #quick-search',function(){
        search();
 });
function getDropDownList(id, optionList,appendTo) {
    var combo = $jq("<select onchange=addvalue('"+id+"','"+appendTo+"');></select>").attr("id", id);
    $jq(optionList).each(function(i,val){
			if(val.options){
					combo.append(getOptLevel(val));
			}else
			combo.append("<option value='"+val.value+"' >" + val.label + "</option>");
	});
	if($jq(combo).find("."+appendTo+" p").length==0) {
		$jq(combo).find("."+appendTo).append("<p></p>");
	}
	$jq(combo).insertBefore("."+appendTo+" p");
    //$jq("."+appendTo).append(combo);
}
function getOptLevel(val) {
	var combo_level2 = "<optgroup label='" + val.label + "' >";					
					 $jq(val.options).each(function(j,val1){
						 if(val1.options){
							 var level = getOptLevel(val1)
							combo_level2 = combo_level2+ level;
						 } else {
							combo_level2 = combo_level2+"<option value='"+val1.value+"' >" + val1.label + "</option>";
						}
					 });
					 combo_level2 = combo_level2+"</optgroup>";
		return combo_level2;
}
function addvalue(id,to_id){
	$jq("#"+to_id).val($jq("#"+id).val());    
}

function search() {
      window.location.search = $jq.param({
        query: $jq("#quick-search").val(),
        status: $jq("#request-status-select").val(),
        organization_id: $jq("#request-organization-select").val()
      });
    }
	

</script>
<script>
	 (function($) {
    $.fn.toJSON = function() {
        var $elements = {};
        var $form = $(this);
        $form.find('input, select, textarea').each(function(){
          var name = $(this).attr('name')
          var type = $(this).attr('type')		 
          if(name){
            var $value;
            if(type == 'radio'){
              $value = $('input[name='+name+']:checked', $form).val()
            } else if(type == 'checkbox'){
              $value = $(this).is(':checked')
            } else {
              $value = $(this).val()
            }
            $elements[$(this).attr('name')] = $value
          }
        });
        return JSON.stringify( $elements )
    };
    $.fn.fromJSON = function(json_string) {
        var $form = $(this)
        var data = JSON.parse(json_string)
        $.each(data, function(key, value) {
          var $elem = $('[name="'+key+'"]', $form)
          var type = $elem.first().attr('type')
          if(type == 'radio'){
            $('[name="'+key+'"][value="'+value+'"]').prop('checked', true)
          } else if(type == 'checkbox' && (value == true || value == 'true')){
            $('[name="'+key+'"]').prop('checked', true)
          } else {
            $elem.val(value)
          }
        })
    };
}( jQuery ));

	$jq(document).ready(function() {
	
	var $form = $jq(this);
        $form.find('input, select, textarea').each(function(){
          var name = $jq(this).attr('name')
          if(!name){
             console.log($jq(this).attr('id'));
			 $jq(this).attr('name', $jq(this).attr('id'));			
          }
   });
   	}) 
	$('new_request').on('submit',function(){
		
		 console.log("Saving form data...")
     var data = $jq("form#new_request").toJSON()
     console.log(data);
     localStorage['form_data'] = data;
     
     return false;
	}) 
</script>
</html>
