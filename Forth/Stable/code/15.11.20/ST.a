 CSEG 
 DSEG 
y_ RB 2
z_ DW 1
w_ DW 1
i_ RB 2
v_ RB 2
m_ RB 2
r_ RB 2
p_ DW 0
n_ RB 2
mx_ RB 2
s_ RB 2
f_ RB 2
st_ RB 4000
t_ DB   0
c_ RB 1
u_ RB 1
a_ RB 1
k_ DB   0
pr_ RB 2000
 CSEG 
 PUBLIC main_
 PUBLIC fopen_
 DSEG 
__22 DB 'rb',0
 CSEG 
 PUBLIC putc_
 PUBLIC exit_
 PUBLIC fgetc_
 PUBLIC fclose_
 PUBLIC atoi_
 PUBLIC getc_
 PUBLIC printf_
 DSEG 
__31 DB '%d',0
 CSEG 

main_: PUSH BP
 MOV BP,SP
 SUB SP,2
 MOV AX,OFFSET __22
 PUSH AX
 MOV SI,WORD [BP+6]
 PUSH WORD [SI+2]
 CALL fopen_
 ADD SP,4
 MOV WORD [BP-2],AX
 CMP AX,0
 JNZ _L1
 MOV AX,1
 PUSH AX
 MOV AX,63
 PUSH AX
 CALL putc_
 ADD SP,4
 MOV AX,1
 PUSH AX
 CALL exit_
 ADD SP,2
_L1:
_L2:
 PUSH WORD [BP-2]
 CALL fgetc_
 ADD SP,2
 MOV BYTE c_,AL
 CMP AL,255
 JZ _L3
 MOV SI,WORD p_
 INC WORD p_
 MOV AL,BYTE c_
 MOV BYTE pr_[SI],AL
 JMP _L2
_L3:
 PUSH WORD [BP-2]
 CALL fclose_
 ADD SP,2
 MOV AX,WORD p_
 MOV WORD mx_,AX
 MOV WORD i_,1999
_L4:
 MOV AX,WORD i_
 DEC WORD i_
 CMP AX,0
 JZ _L5
 MOV SI,WORD i_
 SHL SI,1
 MOV WORD st_[SI],0
 JMP _L4
_L5:
 MOV WORD i_,0
_L6:
 MOV AX,WORD i_
 CMP AX,WORD [BP+4]
 JGE _L7
 CMP WORD i_,1
 JLE _L9
 MOV SI,WORD i_
 SHL SI,1
 ADD SI,WORD [BP+6]
 PUSH WORD [SI]
 CALL atoi_
 ADD SP,2
 MOV SI,WORD i_
 SUB SI,2
 SHL SI,1
 MOV WORD st_[SI],AX
_L9:
_L8:
 INC WORD i_
 JMP _L6
_L7:
 MOV WORD p_,0
 MOV WORD r_,60
 MOV WORD s_,100
_L10:
 MOV AX,WORD p_
 CMP AX,WORD mx_
 JG _L11
 MOV SI,WORD p_
 MOV AL,BYTE pr_[SI]
 MOV BYTE u_,AL
 CMP BYTE u_,125
 JNZ _L12
 MOV SI,WORD r_
 SHL SI,1
 MOV SI,WORD st_[SI]
 MOV WORD p_,SI
 DEC WORD r_
_L12:
 CMP BYTE u_,65
 JB _L13
 CMP BYTE u_,90
 JA _L13
 INC WORD r_
 MOV SI,WORD r_
 SHL SI,1
 MOV AX,WORD p_
 MOV WORD st_[SI],AX
 MOV AL,BYTE u_
 SUB AL,35
 MOV AH,0
 SHL AX,1
 MOV SI,AX
 MOV SI,WORD st_[SI]
 MOV WORD p_,SI
 MOV SI,WORD p_
 MOV AL,BYTE pr_[SI]
 MOV BYTE u_,AL
_L13:
 CMP BYTE u_,123
 JNZ _L14
 MOV SI,WORD p_
 ADD SI,1
 MOV AL,BYTE pr_[SI]
 SUB AL,35
 MOV AH,0
 MOV WORD f_,AX
 MOV AX,WORD p_
 ADD AX,2
 MOV SI,WORD f_
 SHL SI,1
 MOV WORD st_[SI],AX
_L15:
 CMP BYTE u_,125
 JZ _L16
 INC WORD p_
 MOV SI,WORD p_
 MOV AL,BYTE pr_[SI]
 MOV BYTE u_,AL
 JMP _L15
_L16:
 JMP main_nx_
_L14:
 CMP BYTE u_,61
 JNZ _L17
 MOV SI,WORD s_
 SHL SI,1
 MOV AX,WORD s_
 SUB AX,1
 SHL AX,1
 MOV DI,AX
 MOV SI,WORD st_[SI]
 CMP SI,WORD st_[DI]
 JNZ _L18
 MOV SI,WORD s_
 SHL SI,1
 MOV WORD st_[SI],-1
 JMP _L19
_L18:
 MOV SI,WORD s_
 SHL SI,1
 MOV WORD st_[SI],0
_L19:
_L17:
 CMP BYTE u_,62
 JNZ _L20
 MOV SI,WORD s_
 SHL SI,1
 MOV AX,WORD s_
 SUB AX,1
 SHL AX,1
 MOV DI,AX
 MOV SI,WORD st_[SI]
 CMP SI,WORD st_[DI]
 JGE _L21
 MOV SI,WORD s_
 SHL SI,1
 MOV WORD st_[SI],-1
 JMP _L22
_L21:
 MOV SI,WORD s_
 SHL SI,1
 MOV WORD st_[SI],0
_L22:
_L20:
 CMP BYTE u_,60
 JNZ _L23
 MOV SI,WORD s_
 SHL SI,1
 MOV AX,WORD s_
 SUB AX,1
 SHL AX,1
 MOV DI,AX
 MOV SI,WORD st_[SI]
 CMP SI,WORD st_[DI]
 JLE _L24
 MOV SI,WORD s_
 SHL SI,1
 MOV WORD st_[SI],-1
 JMP _L25
_L24:
 MOV SI,WORD s_
 SHL SI,1
 MOV WORD st_[SI],0
_L25:
_L23:
 CMP BYTE u_,91
 JNZ _L26
 INC WORD r_
 MOV SI,WORD r_
 SHL SI,1
 MOV AX,WORD p_
 MOV WORD st_[SI],AX
 MOV SI,WORD s_
 SHL SI,1
 CMP WORD st_[SI],0
 JNZ _L27
 INC WORD p_
 MOV SI,WORD p_
 MOV AL,BYTE pr_[SI]
 MOV BYTE u_,AL
_L28:
 CMP BYTE u_,93
 JZ _L29
 INC WORD p_
 MOV SI,WORD p_
 MOV AL,BYTE pr_[SI]
 MOV BYTE u_,AL
 JMP _L28
_L29:
_L27:
_L26:
 CMP BYTE u_,40
 JNZ _L30
 MOV SI,WORD s_
 SHL SI,1
 CMP WORD st_[SI],0
 JNZ _L31
 DEC WORD s_
 INC WORD p_
 MOV SI,WORD p_
 MOV AL,BYTE pr_[SI]
 MOV BYTE u_,AL
_L32:
 CMP BYTE u_,41
 JZ _L33
 INC WORD p_
 MOV SI,WORD p_
 MOV AL,BYTE pr_[SI]
 MOV BYTE u_,AL
 JMP _L32
_L33:
 JMP _L34
_L31:
 DEC WORD s_
_L34:
_L30:
 CMP BYTE u_,95
 JNZ _L35
 MOV SI,WORD s_
 SHL SI,1
 MOV SI,WORD st_[SI]
 NEG SI
 MOV AX,WORD s_
 SHL AX,1
 MOV DI,AX
 MOV WORD st_[DI],SI
_L35:
 CMP BYTE u_,38
 JNZ _L36
 MOV SI,WORD s_
 SHL SI,1
 MOV AX,WORD s_
 SUB AX,1
 SHL AX,1
 MOV DI,AX
 MOV SI,WORD st_[SI]
 AND WORD st_[DI],SI
 DEC WORD s_
_L36:
 CMP BYTE u_,124
 JNZ _L37
 MOV SI,WORD s_
 SHL SI,1
 MOV AX,WORD s_
 SUB AX,1
 SHL AX,1
 MOV DI,AX
 MOV SI,WORD st_[SI]
 OR WORD st_[DI],SI
 DEC WORD s_
_L37:
 CMP BYTE u_,126
 JNZ _L38
 MOV SI,WORD s_
 SHL SI,1
 MOV SI,WORD st_[SI]
 NOT SI
 MOV AX,WORD s_
 SHL AX,1
 MOV DI,AX
 MOV WORD st_[DI],SI
_L38:
 CMP BYTE u_,43
 JNZ _L39
 CMP BYTE k_,0
 JNZ _L40
 MOV SI,WORD s_
 SHL SI,1
 MOV AX,WORD s_
 SUB AX,1
 SHL AX,1
 MOV DI,AX
 MOV SI,WORD st_[SI]
 ADD WORD st_[DI],SI
 DEC WORD s_
 JMP _L41
_L40:
 MOV SI,WORD v_
 SHL SI,1
 INC WORD st_[SI]
_L41:
_L39:
 CMP BYTE u_,45
 JNZ _L42
 CMP BYTE k_,0
 JNZ _L43
 MOV SI,WORD s_
 SHL SI,1
 MOV AX,WORD s_
 SUB AX,1
 SHL AX,1
 MOV DI,AX
 MOV SI,WORD st_[SI]
 SUB WORD st_[DI],SI
 DEC WORD s_
 JMP _L44
_L43:
 MOV SI,WORD v_
 SHL SI,1
 DEC WORD st_[SI]
_L44:
_L42:
 CMP BYTE u_,42
 JNZ _L45
 MOV SI,WORD s_
 SUB SI,1
 SHL SI,1
 MOV AX,WORD s_
 SHL AX,1
 MOV DI,AX
 MOV AX,WORD st_[SI]
 IMUL WORD st_[DI]
 MOV SI,WORD s_
 SUB SI,1
 SHL SI,1
 MOV WORD st_[SI],AX
 DEC WORD s_
_L45:
 CMP BYTE u_,47
 JNZ _L46
 MOV SI,WORD s_
 SUB SI,1
 SHL SI,1
 MOV AX,WORD s_
 SHL AX,1
 MOV DI,AX
 MOV AX,WORD st_[SI]
 CWD
 IDIV WORD st_[DI]
 MOV SI,WORD s_
 SUB SI,1
 SHL SI,1
 MOV WORD st_[SI],AX
 DEC WORD s_
_L46:
 CMP BYTE u_,37
 JNZ _L47
 MOV SI,WORD s_
 SUB SI,1
 SHL SI,1
 MOV AX,WORD s_
 SHL AX,1
 MOV DI,AX
 MOV AX,WORD st_[SI]
 CWD
 IDIV WORD st_[DI]
 MOV SI,WORD s_
 SUB SI,1
 SHL SI,1
 MOV WORD st_[SI],DX
 DEC WORD s_
_L47:
 CMP BYTE u_,35
 JNZ _L48
 INC WORD s_
 MOV SI,WORD s_
 SUB SI,1
 SHL SI,1
 MOV AX,WORD s_
 SHL AX,1
 MOV DI,AX
 MOV SI,WORD st_[SI]
 MOV WORD st_[DI],SI
_L48:
 CMP BYTE u_,92
 JNZ _L49
 DEC WORD s_
_L49:
 CMP BYTE u_,36
 JNZ _L50
 MOV SI,WORD s_
 SHL SI,1
 MOV SI,WORD st_[SI]
 MOV WORD i_,SI
 MOV SI,WORD s_
 SUB SI,1
 SHL SI,1
 MOV AX,WORD s_
 SHL AX,1
 MOV DI,AX
 MOV SI,WORD st_[SI]
 MOV WORD st_[DI],SI
 MOV SI,WORD s_
 SUB SI,1
 SHL SI,1
 MOV AX,WORD i_
 MOV WORD st_[SI],AX
_L50:
 CMP BYTE u_,64
 JNZ _L51
 MOV SI,WORD s_
 SUB SI,1
 SHL SI,1
 MOV AX,WORD s_
 ADD AX,1
 SHL AX,1
 MOV DI,AX
 MOV SI,WORD st_[SI]
 MOV WORD st_[DI],SI
 INC WORD s_
_L51:
 CMP BYTE u_,94
 JNZ _L52
 MOV AX,0
 PUSH AX
 CALL getc_
 ADD SP,2
 MOV BYTE c_,AL
 CMP BYTE c_,255
 JZ _L54
 CMP BYTE c_,96
 JNZ _L53
_L54:
 MOV AX,0
 PUSH AX
 CALL exit_
 ADD SP,2
 JMP _L55
_L53:
 INC WORD s_
 MOV SI,WORD s_
 SHL SI,1
 MOV AL,BYTE c_
 MOV AH,0
 MOV WORD st_[SI],AX
_L55:
_L52:
 CMP BYTE u_,46
 JNZ _L56
 MOV SI,WORD s_
 SHL SI,1
 PUSH WORD st_[SI]
 MOV AX,OFFSET __31
 PUSH AX
 CALL printf_
 ADD SP,4
 DEC WORD s_
_L56:
 CMP BYTE u_,44
 JNZ _L57
 MOV AX,1
 PUSH AX
 MOV SI,WORD s_
 SHL SI,1
 PUSH WORD st_[SI]
 CALL putc_
 ADD SP,4
 DEC WORD s_
_L57:
 MOV BYTE k_,0
 CMP BYTE u_,97
 JB _L58
 CMP BYTE u_,122
 JA _L58
 MOV BYTE k_,1
 MOV AL,BYTE u_
 SUB AL,97
 MOV AH,0
 MOV WORD v_,AX
_L58:
 CMP BYTE u_,58
 JNZ _L59
 MOV SI,WORD s_
 SHL SI,1
 MOV AX,WORD v_
 SHL AX,1
 MOV DI,AX
 MOV SI,WORD st_[SI]
 MOV WORD st_[DI],SI
 DEC WORD s_
_L59:
 CMP BYTE u_,59
 JNZ _L60
 INC WORD s_
 MOV SI,WORD v_
 SHL SI,1
 MOV AX,WORD s_
 SHL AX,1
 MOV DI,AX
 MOV SI,WORD st_[SI]
 MOV WORD st_[DI],SI
_L60:
 CMP BYTE u_,63
 JNZ _L61
 INC WORD s_
 MOV SI,WORD v_
 SHL SI,1
 MOV SI,WORD st_[SI]
 SHL SI,1
 MOV AX,WORD s_
 SHL AX,1
 MOV DI,AX
 MOV SI,WORD st_[SI]
 MOV WORD st_[DI],SI
_L61:
 CMP BYTE u_,33
 JNZ _L62
 MOV SI,WORD s_
 SHL SI,1
 MOV AX,WORD v_
 SHL AX,1
 MOV DI,AX
 MOV DI,WORD st_[DI]
 SHL DI,1
 MOV SI,WORD st_[SI]
 MOV WORD st_[DI],SI
 DEC WORD s_
_L62:
 CMP BYTE u_,47
 JBE _L63
 CMP BYTE u_,58
 JAE _L63
 MOV WORD i_,0
_L64:
 CMP BYTE u_,47
 JBE _L65
 CMP BYTE u_,58
 JAE _L65
 MOV AX,WORD i_
 MOV CX,10
 IMUL CX
 MOV CL,BYTE u_
 MOV CH,0
 ADD AX,CX
 SUB AX,48
 MOV WORD i_,AX
 INC WORD p_
 MOV SI,WORD p_
 MOV AL,BYTE pr_[SI]
 MOV BYTE u_,AL
 JMP _L64
_L65:
 INC WORD s_
 MOV SI,WORD s_
 SHL SI,1
 MOV AX,WORD i_
 MOV WORD st_[SI],AX
 DEC WORD p_
_L63:
 CMP BYTE u_,34
 JNZ _L66
 INC WORD p_
 MOV SI,WORD p_
 MOV AL,BYTE pr_[SI]
 MOV BYTE u_,AL
_L67:
 CMP BYTE u_,34
 JZ _L68
 MOV AX,1
 PUSH AX
 MOV AL,BYTE u_
 MOV AH,0
 PUSH AX
 CALL putc_
 ADD SP,4
 INC WORD p_
 MOV SI,WORD p_
 MOV AL,BYTE pr_[SI]
 MOV BYTE u_,AL
 JMP _L67
_L68:
_L66:
 CMP BYTE u_,41
 JNZ _L69
_L69:
 CMP BYTE u_,93
 JNZ _L70
 MOV SI,WORD s_
 SHL SI,1
 CMP WORD st_[SI],0
 JZ _L71
 MOV SI,WORD r_
 SHL SI,1
 MOV SI,WORD st_[SI]
 MOV WORD p_,SI
 JMP _L72
_L71:
 DEC WORD r_
_L72:
 DEC WORD s_
_L70:
 CMP BYTE u_,39
 JNZ _L73
 INC WORD p_
 MOV SI,WORD p_
 MOV AL,BYTE pr_[SI]
 MOV BYTE u_,AL
_L74:
 CMP BYTE u_,39
 JZ _L75
 INC WORD s_
 MOV SI,WORD s_
 SHL SI,1
 MOV AL,BYTE u_
 MOV AH,0
 MOV WORD st_[SI],AX
 INC WORD p_
 MOV SI,WORD p_
 MOV AL,BYTE pr_[SI]
 MOV BYTE u_,AL
 JMP _L74
_L75:
_L73:
main_nx_:
 INC WORD p_
 JMP _L10
_L11:
 MOV SP,BP
 POP BP
 RET
 END
